<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF to Document Converter | Convert Labs</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="loading-screen">Loading...</div>
  <div id="app" style="display:none;">
    <header>
      <div class="header-content">
        <img src="assets/convert-labs-logo.png" alt="Convert Labs Logo" class="logo">
        <h1>Convert Labs</h1>
        <button id="themeToggle">ðŸŒ™</button>
      </div>
      <p class="tagline">Convert PDF files into Word, Excel, or Text easily and securely.</p>
    </header>

    <main>
      <section class="converter active">
        <h2>PDF to Document Converter</h2>
        <p>Upload a PDF file and convert it into DOCX, XLSX, or TXT format instantly.</p>
        <div class="converter-box">
          <input type="file" id="pdfFile" accept=".pdf">
          <select id="outputFormat">
            <option value="docx">Word (.docx)</option>
            <option value="xlsx">Excel (.xlsx)</option>
            <option value="txt">Text (.txt)</option>
          </select>
          <button id="convertBtn">Convert</button>
        </div>
        <p id="conversionStatus"></p>
      </section>
    </main>

    <div id="footer-placeholder"></div>
  </div>

  <script>
    // Splash screen
    window.addEventListener("load", () => {
      setTimeout(() => {
        document.getElementById("loading-screen").style.display = "none";
        document.getElementById("app").style.display = "block";
      }, 800);
    });

    // Theme toggle
    document.addEventListener("DOMContentLoaded", () => {
      const toggle = document.getElementById("themeToggle");
      const saved = localStorage.getItem("theme");
      if (saved === "dark") {
        document.body.classList.add("dark-mode");
        toggle.textContent = "â˜€ï¸";
      }
      toggle.addEventListener("click", () => {
        document.body.classList.toggle("dark-mode");
        const dark = document.body.classList.contains("dark-mode");
        toggle.textContent = dark ? "â˜€ï¸" : "ðŸŒ™";
        localStorage.setItem("theme", dark ? "dark" : "light");
      });
    });

    // CloudConvert API token (your personal access key)
    const apiKey = "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiIxIiwianRpIjoiZjA3ZDA3N2E3NzQzMTQ0YzFkYWE2OWI5NzM5NDg5NmExNTI5NzYxMWU2MGMzMDc1ZWQxOTIwYWIwMDkwMGU4YTM5YTJiYmNlYzNjYTAxMDMiLCJpYXQiOjE3NjE0NzY1NTcuMzExMzg0LCJuYmYiOjE3NjE0NzY1NTcuMzExMzg2LCJleHAiOjQ5MTcxNTAxNTcuMzA3NzQxLCJzdWIiOiI3MzI5MzQyOCIsInNjb3BlcyI6WyJ0YXNrLnJlYWQiLCJ0YXNrLndyaXRlIl19.W4JR69t4p6StMrZyC8B3PpJzTO6Dw-X1jtXb6V_-Uz62tWLtdOP5-snkInbOlEkdMO2A4Ph9pVNhgJu8-oMbyvOkcXYMmJbL-VznoCLcDfJuaexVZjC07LTJxTzAP1RP5NA2MSRZF1lNRMeuWGlun5ljXzCb5kERmFD-eLczE7878w8F2cff7vDKQAB3lt8Enk3tK0i6_HdcttxI749HbobZ28afEmXOgXHIeXYKUo-0vpMB1VPUgB1U6HDfRX29oF_li-6KjqwnGHQZ3VgD525BGY6o5IFZHsDEhaJO79sQaFMzAQ1jMN8OVDNbfkCPtfPg71Adkp4ofMuEd6fKh6qkwv2_xDttbItsmLSn-G1SyrTHYAa00M5ko1au-2o8YU9eBIiDmXOgHTSwash35FpnGNuXvSEbtpwdUaZYmfENCQgemkkZgvuMMoB9WBHfShbKdcGyNgGh7Z1aVli0_Cxi2G_wjhBp-OWqulpLJbqIrlQZftJEc-a97Eo2GcZiUYdIIz_UGHBfnBBDg0ahHxpJ-isQOmtmwUItwCj3uwHsrJ43RA-Nw2Yc4hVxDaCV8wfMiywuP6YYTKoubdkEC6J2GLCTl2sychQNC4N6IMHXFLVZ5Mq9XQp2QD221_-5Mdaw5Uy_ZXPMLGfIRYJyVpNwf05jWBrSV3mbayHUtlQ";

    const convertBtn = document.getElementById("convertBtn");
    const statusText = document.getElementById("conversionStatus");

    convertBtn.addEventListener("click", async () => {
      const fileInput = document.getElementById("pdfFile");
      const format = document.getElementById("outputFormat").value;

      if (!fileInput.files.length) {
        alert("Please select a PDF file first.");
        return;
      }

      const file = fileInput.files[0];
      statusText.textContent = "â³ Converting, please wait...";

      try {
        const formData = new FormData();
        formData.append("file", file);

        const uploadResponse = await fetch("https://api.cloudconvert.com/v2/import/upload", {
          method: "POST",
          headers: { Authorization: "Bearer " + apiKey },
        });
        const uploadData = await uploadResponse.json();

        const uploadUrl = uploadData.data.result.form.url;
        const uploadTask = uploadData.data.result.form.parameters;

        const uploadForm = new FormData();
        for (const [key, value] of Object.entries(uploadTask)) uploadForm.append(key, value);
        uploadForm.append("file", file);

        await fetch(uploadUrl, { method: "POST", body: uploadForm });

        const convertResponse = await fetch("https://api.cloudconvert.com/v2/jobs", {
          method: "POST",
          headers: {
            "Authorization": "Bearer " + apiKey,
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            tasks: {
              "import-my-file": {
                operation: "import/upload",
              },
              "convert-my-file": {
                operation: "convert",
                input: "import-my-file",
                input_format: "pdf",
                output_format: format,
              },
              "export-my-file": {
                operation: "export/url",
                input: "convert-my-file",
              },
            },
          }),
        });

        const convertData = await convertResponse.json();
        const jobId = convertData.data.id;

        const jobCheck = async () => {
          const response = await fetch(`https://api.cloudconvert.com/v2/jobs/${jobId}`, {
            headers: { Authorization: "Bearer " + apiKey },
          });
          const jobData = await response.json();
          if (jobData.data.status === "finished") {
            const fileUrl = jobData.data.tasks.find(t => t.operation === "export/url").result.files[0].url;
            statusText.innerHTML = `âœ… Conversion complete! <a href="${fileUrl}" target="_blank">Download file</a>`;
          } else if (jobData.data.status === "error") {
            statusText.textContent = "âŒ Conversion failed. Please try again.";
          } else {
            setTimeout(jobCheck, 3000);
          }
        };
        jobCheck();

      } catch (error) {
        console.error(error);
        statusText.textContent = "âŒ Conversion failed. Please try again.";
      }
    });

    // Load footer dynamically
    fetch("footer.html")
      .then(r => r.text())
      .then(html => document.getElementById("footer-placeholder").innerHTML = html);
  </script>
</body>
</html>
