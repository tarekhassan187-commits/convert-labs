<!-- ‚úÖ JS Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>

<script>
  // üåô Theme Toggle
  document.addEventListener("DOMContentLoaded", () => {
    const toggle = document.getElementById("themeToggle");
    const saved = localStorage.getItem("theme");
    if (saved === "dark") {
      document.body.classList.add("dark-mode");
      toggle.textContent = "‚òÄÔ∏è";
    }
    toggle.addEventListener("click", () => {
      document.body.classList.toggle("dark-mode");
      const dark = document.body.classList.contains("dark-mode");
      toggle.textContent = dark ? "‚òÄÔ∏è" : "üåô";
      localStorage.setItem("theme", dark ? "dark" : "light");
    });
  });

  // üìÑ Enhanced Document ‚Üí PDF Converter
  async function convertToPDF() {
    const input = document.getElementById("fileInput");
    const file = input.files[0];
    const status = document.getElementById("status");
    const download = document.getElementById("downloadLink");

    if (!file) {
      status.textContent = "‚ö†Ô∏è Please select a file to convert.";
      return;
    }

    status.textContent = "‚è≥ Converting...";
    download.style.display = "none";

    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();

    try {
      // üì∑ IMAGE FILES
      if (file.type.startsWith("image/")) {
        const reader = new FileReader();
        reader.onload = e => {
          pdf.addImage(e.target.result, "JPEG", 10, 10, 180, 160);
          finalizePDF(pdf, download, status);
        };
        reader.readAsDataURL(file);
      }

      // üìÑ DOCX FILES
      else if (file.name.endsWith(".docx")) {
        const arrayBuffer = await file.arrayBuffer();
        const result = await window.mammoth.extractRawText({ arrayBuffer });
        const text = result.value.trim() || "‚ö†Ô∏è No readable text found.";
        addTextToPDF(pdf, text);
        finalizePDF(pdf, download, status);
      }

      // üßæ TEXT or HTML FILES
      else if (file.name.endsWith(".txt") || file.name.endsWith(".html") || file.name.endsWith(".csv")) {
        const text = await file.text();
        addTextToPDF(pdf, text);
        finalizePDF(pdf, download, status);
      }

      // ‚öôÔ∏è Unsupported file
      else {
        status.textContent = "‚ö†Ô∏è Unsupported file type. Please use .docx, .txt, .html, .csv, or image files.";
      }
    } catch (err) {
      status.textContent = "‚ùå Conversion failed. Please try again.";
      console.error(err);
    }
  }

  // Helper: Add text safely
  function addTextToPDF(pdf, text) {
    pdf.setFont("helvetica", "normal");
    pdf.setFontSize(12);
    const lines = pdf.splitTextToSize(text, 180);
    pdf.text(lines, 15, 20);
  }

  // Helper: Finalize PDF
  function finalizePDF(pdf, download, status) {
    const pdfBlob = pdf.output("blob");
    const pdfUrl = URL.createObjectURL(pdfBlob);
    download.href = pdfUrl;
    download.style.display = "inline-block";
    download.textContent = "‚¨áÔ∏è Download PDF";
    status.textContent = "‚úÖ Conversion complete!";
  }
</script>
