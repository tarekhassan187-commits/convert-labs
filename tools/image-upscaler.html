<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Image Upscaler ‚Äî Convert Labs</title>
  <meta name="description" content="Free AI-powered image upscaler from Convert Labs ‚Äî upscale your images up to 8√ó with side-by-side preview." />

  <link rel="stylesheet" href="../style.css" />
  <meta name="theme-color" content="#1e40af" />

  <!-- UpscalerJS -->
  <script src="https://cdn.jsdelivr.net/npm/upscaler@1.1.6/dist/browser/upscaler.min.js"></script>

  <style>
    main {
      max-width: 900px;
      margin: 2rem auto;
      padding: 1rem;
    }
    .upload-box {
      border: 2px dashed #1e40af;
      padding: 2rem;
      border-radius: 10px;
      background: #f9fafc;
    }
    .upload-box input[type="file"],
    .upload-box select,
    .upload-box button {
      margin-top: 1rem;
    }
    .preview-container {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      margin-top: 2rem;
      gap: 1rem;
    }
    .preview {
      text-align: center;
    }
    .preview img, canvas {
      max-width: 100%;
      border-radius: 10px;
      border: 1px solid #ccc;
    }
    #status {
      margin-top: 1rem;
      font-weight: 500;
      color: #1e40af;
    }
    .download-btn {
      display: none;
      margin-top: 1rem;
      background: #1e40af;
      color: #fff;
      border: none;
      padding: 0.7rem 1.2rem;
      border-radius: 8px;
      cursor: pointer;
    }
    .download-btn:hover {
      background: #1e3a8a;
    }
    .scale-select {
      font-size: 1rem;
      padding: 0.4rem;
      border-radius: 6px;
    }
  </style>
</head>

<body>
  <header>
    <div class="header-content">
      <a href="../index.html" class="brand" aria-label="Convert Labs home">
        <img src="../assets/convert-labs-icon.png" alt="Convert Labs logo" class="logo" />
        <span class="brand-text">Convert Labs</span>
      </a>

      <div class="header-controls">
        <a href="../contact.html" class="header-btn">Contact Us</a>
        <button id="themeToggle" class="theme-toggle" title="Switch Theme">üåô</button>
      </div>
    </div>
  </header>

  <main>
    <h1>‚ú® AI Image Upscaler</h1>
    <p>Enhance your images up to <strong>8√ó</strong> resolution with side-by-side comparison. Free and fast.</p>

    <div class="upload-box">
      <label><strong>Select an image:</strong></label><br />
      <input type="file" id="imageInput" accept="image/*" />

      <div>
        <label><strong>Upscale level:</strong></label><br />
        <select id="scaleSelect" class="scale-select">
          <option value="2">2√ó</option>
          <option value="4">4√ó</option>
          <option value="8">8√ó</option>
        </select>
      </div>

      <button id="upscaleBtn">Upscale Now</button>
      <p id="status"></p>

      <div class="preview-container">
        <div class="preview">
          <p><strong>Before</strong></p>
          <img id="originalImage" alt="Original preview" />
        </div>
        <div class="preview">
          <p><strong>After</strong></p>
          <canvas id="resultCanvas"></canvas>
        </div>
      </div>

      <button id="downloadBtn" class="download-btn">Download Upscaled Image</button>
    </div>
  </main>

  <footer>
    <p>¬© 2025 Convert Labs</p>
    <div class="footer-links">
      <a href="../about.html">About</a> |
      <a href="../how-to.html">How To</a> |
      <a href="../privacy.html">Privacy</a> |
      <a href="../terms.html">Terms</a> |
      <a href="../contact.html">Contact</a>
    </div>
  </footer>

  <script>
    // Theme toggle
    const toggle = document.getElementById("themeToggle");
    const saved = localStorage.getItem("theme");
    if (saved === "dark") {
      document.body.classList.add("dark-mode");
      toggle.textContent = "‚òÄÔ∏è";
    }
    toggle.addEventListener("click", () => {
      document.body.classList.toggle("dark-mode");
      const dark = document.body.classList.contains("dark-mode");
      toggle.textContent = dark ? "‚òÄÔ∏è" : "üåô";
      localStorage.setItem("theme", dark ? "dark" : "light");
    });

    // UpscalerJS setup
    const upscaler = new window.Upscaler({
      model: "https://cdn.jsdelivr.net/npm/@upscalerjs/esrgan-thick@1.1.0/weights/1x/model.json",
    });

    const imageInput = document.getElementById("imageInput");
    const upscaleBtn = document.getElementById("upscaleBtn");
    const scaleSelect = document.getElementById("scaleSelect");
    const status = document.getElementById("status");
    const originalImage = document.getElementById("originalImage");
    const canvas = document.getElementById("resultCanvas");
    const downloadBtn = document.getElementById("downloadBtn");
    const ctx = canvas.getContext("2d");
    let img = null;

    imageInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;
      img = new Image();
      img.src = URL.createObjectURL(file);
      img.onload = () => {
        originalImage.src = img.src;
        status.textContent = "Image loaded. Ready to upscale.";
      };
    });

    upscaleBtn.addEventListener("click", async () => {
      if (!img) {
        alert("Please select an image first!");
        return;
      }
      const scale = parseInt(scaleSelect.value);
      status.textContent = `Upscaling ${scale}√ó... please wait ‚è≥`;
      downloadBtn.style.display = "none";

      try {
        const result = await upscaler.upscale(img, { patchSize: 128, padding: 2 });
        const offCanvas = document.createElement("canvas");
        offCanvas.width = result.width * (scale / 2);
        offCanvas.height = result.height * (scale / 2);
        const offCtx = offCanvas.getContext("2d");
        offCtx.drawImage(result, 0, 0, offCanvas.width, offCanvas.height);

        canvas.width = offCanvas.width;
        canvas.height = offCanvas.height;
        ctx.drawImage(offCanvas, 0, 0);

        status.textContent = "‚úÖ Upscaling complete!";
        downloadBtn.style.display = "inline-block";

        downloadBtn.onclick = () => {
          const link = document.createElement("a");
          link.download = "upscaled-image.png";
          link.href = canvas.toDataURL();
          link.click();
        };
      } catch (err) {
        console.error(err);
        status.textContent = "‚ùå Error during upscaling. Try a smaller image.";
      }
    });
  </script>
</body>
</html>
