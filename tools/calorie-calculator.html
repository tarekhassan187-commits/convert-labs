<!doctype html>
<html lang="en">
<head>
  <!-- ‚úÖ Social Meta -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calorie Calculator ‚Äî Convert Labs</title>
  <meta name="description" content="Estimate calories, protein, carbs, sugar, and fat for thousands of foods from the USDA database." />
  <link rel="icon" href="https://convertlabs.online/assets/convert-labs-icon.png" />
  <meta name="theme-color" content="#1e40af" />
  <link rel="stylesheet" href="https://convertlabs.online/style.css" />
<link rel="canonical" href="https://convertlabs.online/tools/calorie-guide.html">
 
  <!-- Open Graph -->
  <meta property="og:title" content="Calorie Calculator ‚Äî Convert Labs" />
  <meta property="og:description" content="Estimate calories, protein, carbs, fat, and sugar for thousands of foods using Convert Labs' free calorie calculator ‚Äî powered by USDA data." />
  <meta property="og:image" content="https://convertlabs.online/assets/guide-calories.png" />
  <meta property="og:url" content="https://convertlabs.online/tools/calorie-calculator.html" />
  <meta property="og:type" content="website" />

  <!-- AdSense & Analytics -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2490597435056272" crossorigin="anonymous"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z88B03WV7P"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-Z88B03WV7P');
  </script>

  <!-- Breadcrumb JSON-LD -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://convertlabs.online/" },
      { "@type": "ListItem", "position": 2, "name": "Tools", "item": "https://convertlabs.online/tools/tools.html" },
      { "@type": "ListItem", "position": 3, "name": "Calorie Calculator" }
    ]
  }
  </script>

  <style>
    /* Unified Design System Variables */
    :root {
      --brand: #0a4d8c;
      --brand-2: #134b8b;
      --muted: #6c6c6c;
      --bg: #f5faff;
      --card: #fff;
      --accent: #2b8bd8;
      --radius: 12px;
      --text: #111;
      --brand-blue: #2563eb;
      --brand-blue-dark: #1e40af;
      --card-bg: #ffffff;
    }

    html.dark {
      --bg: #071029;
      --card: #081226;
      --text: #dbeafe;
      --muted: #9aa9b8;
      --accent: #34d399;
    }

    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
    }

    /* === UNIFIED HEADER STYLES === */
    header {
      height: auto;
      min-height: 64px;
      background: var(--brand-2);
      color: #fff;
      display: flex;
      align-items: center;
      padding: 12px 20px;
      position: sticky;
      top: 0;
      z-index: 100;
      flex-wrap: wrap;
      gap: 12px;
      width: 100%;
    }

    .brand {
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-shrink: 0;
    }

    .nav-links {
      display: flex;
      gap: 12px;
      margin: 0 auto;
      flex-wrap: wrap;
      justify-content: center;
    }

    .nav-links a {
      color: #fff;
      text-decoration: none;
      font-weight: 500;
      padding: 6px 10px;
      border-radius: 6px;
      transition: background-color 0.2s;
      font-size: 14px;
    }

    .nav-links a:hover {
      background: rgba(255,255,255,0.1);
    }

    .btn {
      background: var(--brand);
      color: #fff;
      padding: 8px 12px;
      border-radius: 10px;
      border: 0;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
      flex-shrink: 0;
    }

    .btn:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .btn.ghost {
      background: transparent;
      border: 1px solid var(--brand);
      color: var(--brand);
    }

    .theme-toggle-container {
      margin-left: auto;
      flex-shrink: 0;
    }

    /* === EXISTING CALCULATOR STYLES === */
    main { padding: 28px 0 60px; }

    .calculator-wrap { 
      max-width:920px; 
      margin: 24px auto; 
      padding: 28px; 
      border-radius: 14px; 
      background: var(--card); 
      box-shadow: 0 10px 30px rgba(2,6,23,0.06); 
    }
    
    .calculator-inner { 
      max-width:820px; 
      margin:auto; 
      padding: 20px; 
      border-radius: 12px; 
      background: var(--card); 
      box-shadow: 0 6px 18px rgba(2,6,23,0.06); 
    }

    h1 { margin:0 0 14px; color:var(--text); font-size:1.9rem; display:flex; align-items:center; gap:10px; }
    p.lead { margin: 8px 0 18px; color:var(--muted); }

    .search-row { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    #foodInput { padding:10px 12px; border-radius:8px; border:1px solid #e6edf3; width: 380px; box-sizing:border-box; font-size:15px; background: var(--card); color: var(--text); }
    #searchBtn { padding:9px 14px; border-radius:8px; background:var(--brand-blue); color:#fff; border:none; cursor:pointer; font-weight:600; }
    #searchBtn:hover { background:var(--brand-blue-dark); }

    .serving-input { margin-top:18px; display:flex; gap:12px; align-items:center; }
    #servingSize { width:120px; padding:8px 10px; border-radius:8px; border:1px solid #e6edf3; background: var(--card); color: var(--text); }

    .search-field {
      position:relative;
      display:inline-block;
    }
    .suggestions {
      position:absolute;
      top:calc(100% + 8px);
      left:0;
      right:auto;
      min-width:340px;
      max-width:760px;
      background:var(--card);
      border:1px solid #e6edf3;
      border-radius:10px;
      box-shadow:0 8px 24px rgba(2,6,23,0.08);
      max-height:300px;
      overflow:auto;
      z-index:1200;
      display:none;
    }
    .suggestions .item { padding:10px 14px; cursor:pointer; border-bottom:1px solid #f1f5f9; color: var(--text); }
    .suggestions .item:hover { background:#f1f5f9; }
    .suggestions .item strong { color:var(--brand-blue); font-weight:700; }
    .suggestions .show-more { display:block; padding:12px; text-align:center; background:var(--brand-blue); color:#fff; cursor:pointer; border-radius:0 0 10px 10px; margin-top:0; font-weight:600; }

    .result-card { margin-top:18px; padding:16px; border-radius:10px; background:#f8fafc; border:1px solid #e6edf3; color: var(--text); }
    .chart-container { height:260px; margin-top:12px; }

    .actions { margin-top:12px; display:flex; gap:10px; }
    .btn-green { background:#16a34a; color:#fff; padding:8px 12px; border-radius:8px; border:none; cursor:pointer; }
    .btn-red { background:#dc2626; color:#fff; padding:8px 12px; border-radius:8px; border:none; cursor:pointer; }

    .result-summary { margin-top:14px; padding:12px; border-radius:10px; background:#f8fafc; border:1px solid #e6edf3; display:none; color: var(--text); }

    .about { margin-top:18px; color:var(--muted); font-size:0.96rem; }

    /* === UNIFIED FOOTER STYLES === */
    footer.footer { 
      background: var(--brand-2); 
      color:#fff; 
      text-align:center; 
      padding:2rem 1rem; 
      margin-top:2.5rem; 
      width: 100%;
    }

    footer.footer a { 
      color: #f8fafc; 
      text-decoration: none;
    }

    footer.footer a:hover { 
      text-decoration: underline; 
      color: #ffffff; 
    }

    /* Dark mode adaptations */
    html.dark .calculator-wrap,
    html.dark .calculator-inner {
      background: var(--card);
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
    }

    html.dark #foodInput,
    html.dark #servingSize,
    html.dark .suggestions,
    html.dark .result-card,
    html.dark .result-summary {
      background: var(--card);
      color: var(--text);
      border: 1px solid #233142;
    }

    html.dark #foodInput::placeholder { color: var(--muted); }
    html.dark .suggestions { box-shadow: 0 8px 30px rgba(0,0,0,0.6); border-color:#233142; }
    html.dark .suggestions .item { border-bottom:1px solid #233142; }
    html.dark .suggestions .item:hover { background:#1e293b; }
    html.dark .suggestions .item strong { color:#60a5fa; }

    html.dark .result-card, 
    html.dark .result-summary { 
      background: var(--card); 
      border-color:#233142; 
    }

    /* Nutrition disclaimer styles */
    .nutrition-disclaimer {
      margin-top: 30px;
      padding: 18px;
      background: #f7f7f7;
      border-left: 4px solid #4A90E2;
      border-radius: 6px;
      font-size: 15px;
      line-height: 1.6;
      color: #222;
    }

    html.dark .nutrition-disclaimer {
      background: #1c253a !important;
      color: #e7e7e7 !important;
      border-left: 4px solid #6aa0ff !important;
    }

    /* Modal styles */
    .results-modal-overlay { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(2,6,23,0.45); z-index:1400; }
    .results-modal { width:94%; max-width:820px; max-height:82vh; border-radius:12px; overflow:hidden; background:var(--card); box-shadow: 0 12px 40px rgba(2,6,23,0.3); display:flex; flex-direction:column; }
    .results-modal-header { padding:14px 16px; background:#f8fafc; border-bottom:1px solid #e6edf3; font-weight:700; position:sticky; top:0; z-index:5; color: var(--text); }
    .results-modal-content { padding:8px 12px; overflow:auto; }
    .suggestion-item { padding:10px 12px; border-bottom:1px solid #f1f5f9; cursor:pointer; color: var(--text); }
    .results-modal-footer { padding:10px 12px; background:#f8fafc; text-align:right; border-top:1px solid #e6edf3; position:sticky; bottom:0; z-index:5; }

    html.dark .results-modal { background:var(--card); color:var(--text); box-shadow:0 12px 44px rgba(0,0,0,0.7); }
    html.dark .results-modal-header, 
    html.dark .results-modal-footer { background:var(--card); border-color:#233142; }
    html.dark .suggestion-item { border-bottom:1px solid #233142; }
    html.dark .suggestion-item:hover { background:#1e293b; }

    .muted { color:var(--muted); font-size:0.95rem; }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
      header {
        padding: 10px 16px;
        gap: 8px;
      }
      .nav-links {
        gap: 8px;
      }
      .nav-links a {
        padding: 5px 8px;
        font-size: 13px;
      }
      .brand span {
        font-size: 14px;
      }
      #foodInput { width: 100%; min-width: 0; }
      .suggestions { min-width: calc(100% - 40px); left:0; right:0; }
      .calculator-wrap { margin: 18px; }
    }

    @media (max-width: 480px) {
      .nav-links {
        gap: 6px;
      }
      .nav-links a {
        padding: 4px 6px;
        font-size: 12px;
      }
      header {
        padding: 8px 12px;
      }
    }

    @media (max-width:720px){
      .hero-title { font-size:1.6rem; }
    }
  </style>
</head>
<body>
  <!-- === UNIFIED HEADER === -->
  <header role="banner">
    <div class="brand">
      <img src="https://convertlabs.online/assets/convert-labs-icon.png" alt="Convert Labs" style="width:32px;height:32px;">
      <span>Convert Labs</span>
    </div>
    <nav class="nav-links" aria-label="Main navigation">
      <a href="https://convertlabs.online/index.html">Home</a>
      <a href="https://convertlabs.online/tools/tools.html">Tools</a>
      <a href="https://convertlabs.online/guides.html">Blog</a>
      <a href="https://convertlabs.online/about.html">About</a>
      <a href="https://convertlabs.online/contact.html">Contact</a>
    </nav>
    <div class="theme-toggle-container">
      <button id="themeToggle" class="btn ghost" style="min-width:44px;">üåô</button>
    </div>
  </header>

 <section style="max-width:900px;margin:30px auto 25px auto;padding:0 16px;line-height:1.7;">
  <h2 style="color:var(--brand-2);font-size:1.7rem;margin-bottom:12px;">
    Calculate Calories, TDEE, BMR & Daily Macros ‚Äî Based on Real Nutrition Data
  </h2>

  <p style="color:var(--text);">
    This calorie calculator helps you estimate your daily calorie needs using 
    <strong>BMR (Basal Metabolic Rate)</strong> and 
    <strong>TDEE (Total Daily Energy Expenditure)</strong>. 
    It also includes a food calorie database so you can calculate calories from meals 
    by entering grams, cups or portions.
  </p>

  <p style="color:var(--text);margin-top:12px;">
    People commonly search for: 
    <strong>"online calorie calculator"</strong>,  
    <strong>"calories in food"</strong>,  
    <strong>"grams to calories"</strong>,  
    <strong>"TDEE calculator"</strong>,  
    and <strong>"daily calorie needs"</strong>.  
    This tool covers all of them in one place.
  </p>

  <h3 style="color:var(--brand-2);margin-top:22px;font-size:1.3rem;">What this calculator does</h3>
  <ul style="color:var(--text);margin-left:18px;">
    <li>‚úî Calculates BMR using Mifflin‚ÄìSt Jeor (most accurate modern formula)</li>
    <li>‚úî Calculates TDEE based on activity level</li>
    <li>‚úî Converts food weight (g) into calories using nutrition profiles</li>
    <li>‚úî Estimates macros (protein, carbs, fat) for weight loss or muscle gain</li>
    <li>‚úî Works for metric & imperial units</li>
  </ul>

  <p style="color:var(--text);margin-top:14px;">
    Need deeper insight about how calorie estimation works, macros and serving sizes?
    Read the full guide:
    <a href="/guides/guide-calories.html" style="color:var(--brand-blue);font-weight:600;">Calories & Nutrition Guide</a>.
  </p>
</section>

  <main>
    <section class="calculator-wrap">
      <div class="calculator-inner" role="region" aria-label="Calorie Calculator">
        <h1>üî• <span>Calorie Calculator</span></h1>
        <p class="lead">Search thousands of foods to estimate calories, protein, carbs, sugar, and fat per 100 g serving.</p>

        <div class="search-row" style="margin-bottom:6px;">
          <div class="search-field" aria-haspopup="listbox">
            <input id="foodInput" type="text" placeholder="Enter food name (e.g., chicken, rice, falafel)" autocomplete="off" aria-label="Food name">
            <div id="suggestions" class="suggestions" role="listbox" aria-label="Search suggestions"></div>
          </div>

          <button id="searchBtn" aria-label="Search">Search</button>
        </div>

        <div class="serving-input">
          <label for="servingSize" style="font-weight:600;">Serving Size (grams):</label>
          <input id="servingSize" type="number" min="1" value="100" aria-label="Serving size in grams">
        </div>

        <div id="resultContainer" aria-live="polite"></div>

        <section id="dailySummary" class="result-summary" aria-hidden="true">
          <h3 style="margin:0 0 8px">Daily Summary</h3>
          <div id="dailyTotals" style="font-size:0.98rem;"></div>
          <div style="margin-top:10px;">
            <button id="clearAllBtn" class="btn-red" style="background:#ef4444;">Clear All</button>
          </div>
        </section>
        
        <div style="margin-top:20px;font-size:14px;line-height:1.6;">
  <strong>How This Calculator Works:</strong><br>
  Daily calorie needs are estimated using the 
  <strong>Mifflin‚ÄìSt Jeor Equation</strong>, one of the most widely accepted scientific formulas 
  for calculating Basal Metabolic Rate (BMR). Your result is then adjusted using an activity 
  multiplier to estimate Total Daily Energy Expenditure (TDEE).
</div>

<div class="nutrition-disclaimer">
  <strong>Nutrition Data Notice:</strong><br>
  All nutrition values provided on this website come exclusively from the 
  <strong>USDA FoodData Central</strong> public-domain database.<br>
  Traditional or regional dishes have been temporarily removed to comply with 
  <strong>Google Publisher Policies</strong> relating to health and nutrition data accuracy.<br><br>
  This tool is intended for general informational purposes only and should not be considered medical,
  nutritional, or dietary advice. For personalized guidance, please consult a certified nutritionist
  or healthcare professional.
</div>

        <div class="about" style="margin-top:20px;">
          <strong style="display:block;margin-bottom:8px;color:inherit">About This Tool</strong>
          <p class="muted">This calorie calculator retrieves real food data from the official USDA nutrient database (2021‚Äì2023 FNDDS). Each result includes the energy (kcal) and macronutrients per 100 g of edible portion. Use the serving size input to scale values to your portion.</p>
          <ul style="margin:12px 0 0 18px;color:var(--muted);">
            <li>‚ö° <strong>Calories (kcal)</strong> ‚Äî energy per 100 g</li>
            <li>üçó <strong>Protein</strong> ‚Äî grams of protein</li>
            <li>ü•ñ <strong>Carbs</strong> ‚Äî grams of carbohydrate</li>
            <li>ü•ë <strong>Fat</strong> ‚Äî grams of total fat</li>
            <li>üçØ <strong>Sugar</strong> ‚Äî grams of total sugars</li>
          </ul>

          <div style="text-align:center; margin-top:24px;">
  <a href="https://convertlabs.online/tools/calorie-guide.html"
     style="
       display:inline-block;
       background:var(--brand-blue);
       color:#fff;
       padding:12px 22px;
       border-radius:8px;
       font-weight:600;
       text-decoration:none;
       box-shadow:0 4px 10px rgba(37,99,235,0.25);
       transition:all 0.25s ease;
     "
     onmouseover="this.style.background='var(--brand-blue-dark)'; this.style.boxShadow='0 4px 12px rgba(30,64,175,0.35)';"
     onmouseout="this.style.background='var(--brand-blue)'; this.style.boxShadow='0 4px 10px rgba(37,99,235,0.25)';">
     üìò Explore Full Calorie & Nutrition Guide
  </a>
</div>

        </div>
      </div>
    </section>
  </main>

  <!-- === UNIFIED FOOTER === -->
  <footer class="footer">
    <div class="container" style="max-width:1100px;margin:0 auto;text-align:center;padding:20px;">
      <div class="footer-brand" style="margin-bottom:10px;">
        <img src="https://convertlabs.online/assets/convert-labs-icon.png" alt="Convert Labs" style="width:24px;height:24px;vertical-align:middle;">
        <span style="margin-left:6px;font-weight:600;">Convert Labs</span>
      </div>

      <p style="color:#ffffff;margin-bottom:10px;">¬© 2025 Convert Labs. All rights reserved.</p>

      <div style="width:100%;max-width:700px;height:1px;background:rgba(255,255,255,0.2);margin:0 auto 10px auto;"></div>

      <nav class="footer-links" style="margin-top:8px;">
        <a href="https://convertlabs.online/about.html" style="color:#f8fafc;text-decoration:none;margin:0 6px;">About</a> |
        <a href="https://convertlabs.online/tools/tools.html" style="color:#f8fafc;text-decoration:none;margin:0 6px;">Tools</a> |
        <a href="https://convertlabs.online/guides.html" style="color:#f8fafc;text-decoration:none;margin:0 6px;">Blog</a> |
        <a href="https://convertlabs.online/privacy.html" style="color:#f8fafc;text-decoration:none;margin:0 6px;">Privacy</a> |
        <a href="https://convertlabs.online/disclaimer.html" style="color:#f8fafc;text-decoration:none;margin:0 6px;">Disclaimer</a> |
        <a href="https://convertlabs.online/terms.html" style="color:#f8fafc;text-decoration:none;margin:0 6px;">Terms</a> |
        <a href="https://convertlabs.online/contact.html" style="color:#f8fafc;text-decoration:none;margin:0 6px;">Contact</a>
      </nav>
    </div>
    <section class="site-verification" style="font-size:14px; color:#f1f1f1; text-align:center; margin-top:25px; line-height:1.6;">
      <p>‚úÖ <strong>Domain Verification & Email Security</strong></p>
      <p>
        Convert Labs is officially verified for secure DNS and authenticated email delivery.  
        Our domain (<a href="https://convertlabs.online" target="_blank" style="color:#9dc6ff;">convertlabs.online</a>)  
        uses trusted <strong>Cloudflare</strong> infrastructure with validated DNS records.
      </p>
      <p>
        Email protection includes:
        <ul style="list-style:none; padding:0; margin:5px 0;">
          <li>‚úî <strong>SPF</strong> ‚Äì Approved senders: Cloudflare & Outlook Mail servers</li>
          <li>‚úî <strong>DKIM</strong> ‚Äì 2048-bit RSA signature verified (<em>selector: cf2024-1</em>)</li>
          <li>‚úî <strong>DMARC</strong> ‚Äì Active monitoring for spoofing and spam prevention</li>
        </ul>
      </p>
      <p>
        These records confirm the legitimacy of our domain and improve deliverability,  
        search engine trust, and AdSense approval readiness.
      </p>
    </section>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <script>
    // Theme toggle functionality
    function initTheme() {
      const savedTheme = localStorage.getItem('convertlabs-theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
        document.documentElement.classList.add('dark');
        document.getElementById('themeToggle').textContent = '‚òÄÔ∏è';
      } else {
        document.documentElement.classList.remove('dark');
        document.getElementById('themeToggle').textContent = 'üåô';
      }
    }

    function toggleTheme() {
      const isDark = document.documentElement.classList.toggle('dark');
      document.getElementById('themeToggle').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
      localStorage.setItem('convertlabs-theme', isDark ? 'dark' : 'light');
      if(window.updateChartColors) window.updateChartColors();
    }

    // Initialize theme and event listener
    document.addEventListener('DOMContentLoaded', function() {
      initTheme();
      document.getElementById('themeToggle').addEventListener('click', toggleTheme);
    });
  </script>

  <!-- Rest of the calorie calculator JavaScript remains unchanged -->
  <script>
  (function(){
    const foodInput = document.getElementById('foodInput');
    const searchBtn = document.getElementById('searchBtn');
    const suggestionsBox = document.getElementById('suggestions');
    const servingSize = document.getElementById('servingSize');
    const resultContainer = document.getElementById('resultContainer');
    const dailySummary = document.getElementById('dailySummary');
    const dailyTotalsDiv = document.getElementById('dailyTotals');
    const clearAllBtn = document.getElementById('clearAllBtn');

    let foodData = [], foodIndex = [];
    let currentFood = null;
    let chart = null;
    let dailyTotals = { kcal:0, protein:0, carbs:0, fat:0, sugar:0 };

    Promise.all([
      fetch('https://convertlabs.online/assets/usda_food_nutrition.json').then(r=>r.json()).catch(()=>[]),
      fetch('https://convertlabs.online/assets/foods-full.json').then(r=>r.json()).catch(()=>[]),
      fetch('https://convertlabs.online/assets/foods-lite.json').then(r=>r.json()).catch(()=>[])
    ]).then(arrs=>{
      const combined = arrs.flat();
      const seen = new Set();
      foodData = combined.filter(it => {
        const key = ((it.name||it.food)||'').toLowerCase().trim();
        if(!key) return false;
        if(seen.has(key)) return false;
        seen.add(key);
        return true;
      });
      buildIndex(foodData);
      console.log('Food data loaded:', foodData.length);
    }).catch(err=>{
      console.error('Failed to load food JSONs', err);
    });

    function normalizeText(s){ return String(s||'').normalize('NFKD').replace(/\p{Diacritic}/gu,'').toLowerCase().trim(); }
    function buildIndex(data){
      foodIndex = data.map(item=>{
        const name = item.name || item.food || '';
        const norm = normalizeText(name);
        const tokens = Array.from(new Set(norm.split(/\s+/).filter(Boolean)));
        return { name, norm, tokens, original:item };
      });
    }

    function scoreItem(qNorm, item){
      const n = item.norm;
      if(n === qNorm) return 100;
      if(n.startsWith(qNorm)) return 85;
      if(item.tokens.includes(qNorm)) return 75;
      if(n.includes(qNorm)) return 55;
      return 0;
    }

    function getSuggestions(q, max=20){
      const qNorm = normalizeText(q);
      if(!qNorm) return { results:[], total:0 };
      const scored = [];
      for(const item of foodIndex){
        const s = scoreItem(qNorm, item);
        if(s>0) scored.push({item,score:s});
      }
      scored.sort((a,b)=>b.score - a.score);
      const total = scored.length;
      return { results: scored.slice(0,max).map(s=>s.item), total };
    }

    function highlightMatch(text, q){
      const norm = normalizeText(text);
      const nq = normalizeText(q);
      const idx = norm.indexOf(nq);
      if(idx === -1) return text;
      const before = text.slice(0, idx);
      const match = text.slice(idx, idx + nq.length);
      const after = text.slice(idx + nq.length);
      return `${escapeHtml(before)}<strong>${escapeHtml(match)}</strong>${escapeHtml(after)}`;
    }

    function renderSuggestions(q){
      const { results, total } = getSuggestions(q);
      if(!results.length){ suggestionsBox.style.display='none'; return; }
      const items = results.map(r=>`<div class="item" role="option">${highlightMatch(r.name, q)}</div>`).join('');
      let html = items;
      if(total > results.length){
        html += `<div class="show-more" role="button" tabindex="0">üîç Show all ${total} results for "${escapeHtml(q)}"</div>`;
      }
      suggestionsBox.innerHTML = html;
      suggestionsBox.style.display = 'block';
    }

    function showFullResults(q){
      const { results, total } = getSuggestions(q, 1000);
      const overlay = document.createElement('div');
      overlay.className = 'results-modal-overlay';
      overlay.addEventListener('click', (ev)=>{ if(ev.target === overlay) closeModal(); });

      const modal = document.createElement('div');
      modal.className = 'results-modal';
      modal.setAttribute('role','dialog');
      modal.setAttribute('aria-label','All search results');
      modal.innerHTML = `
        <div class="results-modal-header">All ${total} results for "${escapeHtml(q)}"</div>
        <div class="results-modal-content"></div>
        <div class="results-modal-footer"><button id="closeModalBtn" style="padding:8px 14px;border-radius:8px;border:none;background:var(--brand-blue);color:#fff;cursor:pointer;">Close</button></div>
      `;
      overlay.appendChild(modal);
      document.body.appendChild(overlay);

      const content = modal.querySelector('.results-modal-content');
      if(results.length === 0) content.innerHTML = '<p style="padding:12px">No results found.</p>';
      else content.innerHTML = results.map(r => `<div class="suggestion-item" tabindex="0">${escapeHtml(r.name)}</div>`).join('');

      content.querySelectorAll('.suggestion-item').forEach(node=>{
        node.addEventListener('click', ()=>{
          foodInput.value = node.textContent.trim();
          suggestionsBox.style.display = 'none';
          closeModal();
          searchFood();
        });
      });

      document.getElementById('closeModalBtn').addEventListener('click', closeModal);

      function escHandler(e){ if(e.key === 'Escape') closeModal(); }
      window.addEventListener('keydown', escHandler);

      function closeModal(){
        window.removeEventListener('keydown', escHandler);
        if(overlay.parentNode) overlay.parentNode.removeChild(overlay);
      }
    }

    suggestionsBox.addEventListener('click', (e)=>{
      const target = e.target.closest('.item');
      if(!target) {
        if(e.target.classList.contains('show-more')) {
          showFullResults(foodInput.value.trim());
        }
        return;
      }
      const name = target.textContent.trim();
      foodInput.value = name;
      suggestionsBox.style.display = 'none';
      searchFood();
    });

    suggestionsBox.addEventListener('keydown', (e)=>{
      const t = e.target;
      if(t && t.classList && t.classList.contains('show-more') && (e.key === 'Enter' || e.key === ' ')) {
        e.preventDefault();
        showFullResults(foodInput.value.trim());
      }
    });

    let debounce;
    foodInput.addEventListener('input', (e)=>{
      const q = e.target.value.trim();
      clearTimeout(debounce);
      if(!q){ suggestionsBox.style.display='none'; return; }
      debounce = setTimeout(()=> renderSuggestions(q), 180);
    });

    document.addEventListener('click', (e)=>{
      if(!e.target.closest('.search-field')) suggestionsBox.style.display='none';
    });

    searchBtn.addEventListener('click', searchFood);
    foodInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter'){ e.preventDefault(); searchFood(); } });

    function searchFood(){
      const term = (foodInput.value || '').trim();
      if(!term){ resultContainer.innerHTML=''; currentFood = null; return; }
      const lower = term.toLowerCase();
      let match = foodData.find(it => ((it.name||it.food)||'').toLowerCase() === lower);
      if(!match) match = foodData.find(it => ((it.name||it.food)||'').toLowerCase().includes(lower));
      if(!match){
        resultContainer.innerHTML = `<div class="result-card"><p style="color:#b91c1c;margin:0">‚ùå No results for <strong>${escapeHtml(term)}</strong>.</p></div>`;
        currentFood = null;
        if(chart){ chart.destroy(); chart = null; }
        return;
      }
      currentFood = match;
      displayResult(match);
    }

    function displayResult(food){
      const serving = Number(servingSize.value) || 100;
      const factor = serving / 100;
      const scaled = {
        kcal: (Number(food.kcal) || 0) * factor,
        protein: (Number(food.protein) || 0) * factor,
        carbs: (Number(food.carbs) || 0) * factor,
        fat: (Number(food.fat) || 0) * factor,
        sugar: (Number(food.sugar) || 0) * factor
      };

      resultContainer.innerHTML = `
        <div class="result-card" aria-live="polite">
          <h3 style="margin:0 0 8px">${escapeHtml(food.name)}</h3>
          <p style="margin:6px 0;"><strong>Serving Size:</strong> <span id="resServing">${serving}</span> g</p>
          <p style="margin:6px 0;"><strong>Calories:</strong> <span id="resKcal">${scaled.kcal.toFixed(1)}</span> kcal</p>
          <p style="margin:6px 0;"><strong>Protein:</strong> <span id="resProtein">${scaled.protein.toFixed(1)}</span> g</p>
          <p style="margin:6px 0;"><strong>Carbs:</strong> <span id="resCarbs">${scaled.carbs.toFixed(1)}</span> g</p>
          <p style="margin:6px 0;"><strong>Fat:</strong> <span id="resFat">${scaled.fat.toFixed(1)}</span> g</p>
          <p style="margin:6px 0;"><strong>Sugar:</strong> <span id="resSugar">${scaled.sugar.toFixed(1)}</span> g</p>
          <div class="chart-container"><canvas id="nutrientChart"></canvas></div>
          <div class="actions">
            <button id="addToTotalBtn" class="btn-green">Add to Daily Summary</button>
            <button id="clearBtn" class="btn-red">Clear</button>
          </div>
        </div>
      `;

      drawChart(scaled);

      document.getElementById('addToTotalBtn').addEventListener('click', ()=> {
        addToDailyTotal(scaled);
      });
      document.getElementById('clearBtn').addEventListener('click', ()=> {
        foodInput.value = '';
        servingSize.value = 100;
        resultContainer.innerHTML = '';
        currentFood = null;
        if(chart){ chart.destroy(); chart = null; }
      });
    }

    function drawChart(data){
      const ctx = document.getElementById('nutrientChart');
      if(!ctx) return;
      if(chart) chart.destroy();
      const dark = document.documentElement.classList.contains('dark');
      const textColor = dark ? '#e6eef8' : '#111827';
      const barColor = dark ? '#60a5fa' : '#2563eb';
      chart = new Chart(ctx.getContext('2d'), {
        type: 'bar',
        data: {
          labels: ['Calories','Protein','Carbs','Fat','Sugar'],
          datasets: [{ data: [data.kcal, data.protein, data.carbs, data.fat, data.sugar], backgroundColor: barColor, borderRadius:6 }]
        },
        options: {
          responsive:true,
          maintainAspectRatio:false,
          plugins:{ legend:{ display:false } },
          scales:{
            x: { ticks: { color: textColor } },
            y: { beginAtZero:true, ticks: { color: textColor } }
          }
        }
      });
    }

    window.updateChartColors = function(){
      if(!chart) return;
      const dark = document.documentElement.classList.contains('dark');
      const barColor = dark ? '#60a5fa' : '#2563eb';
      const textColor = dark ? '#e6eef8' : '#111827';
      chart.data.datasets[0].backgroundColor = barColor;
      chart.options.scales.x.ticks.color = textColor;
      chart.options.scales.y.ticks.color = textColor;
      chart.update();
    };

    function addToDailyTotal(data){
      for(const k of Object.keys(dailyTotals)) {
        dailyTotals[k] = (dailyTotals[k] || 0) + (data[k] || 0);
      }
      updateDailySummary();
    }
    function updateDailySummary(){
      dailySummary.style.display = 'block';
      dailySummary.setAttribute('aria-hidden','false');
      dailyTotalsDiv.innerHTML = `
        <p style="margin:6px 0"><strong>Calories:</strong> ${dailyTotals.kcal.toFixed(1)} kcal</p>
        <p style="margin:6px 0"><strong>Protein:</strong> ${dailyTotals.protein.toFixed(1)} g</p>
        <p style="margin:6px 0"><strong>Carbs:</strong> ${dailyTotals.carbs.toFixed(1)} g</p>
        <p style="margin:6px 0"><strong>Fat:</strong> ${dailyTotals.fat.toFixed(1)} g</p>
        <p style="margin:6px 0"><strong>Sugar:</strong> ${dailyTotals.sugar.toFixed(1)} g</p>
      `;
    }

    clearAllBtn.addEventListener('click', ()=>{
      dailyTotals = { kcal:0, protein:0, carbs:0, fat:0, sugar:0 };
      dailySummary.style.display = 'none';
      dailySummary.setAttribute('aria-hidden','true');
    });

    servingSize.addEventListener('input', ()=>{
      if(!currentFood) return;
      displayResult(currentFood);
    });

    function escapeHtml(s){
      return String(s || '').replace(/[&<>"]/g, function(c){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]; });
    }

    window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') suggestionsBox.style.display='none'; });

  })();
  </script>
</body>
</html>

