<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Calorie Calculator ‚Äî Convert Labs</title>

  <meta name="description" content="Estimate calories, protein, carbs, sugar, and fat for thousands of foods from the USDA database. Accurate nutrition info per 100 g or custom serving size." />
  <link rel="icon" href="../assets/convert-labs-icon.png" />
  <meta name="theme-color" content="#1e40af" />
  <link rel="stylesheet" href="../style.css" />

  <style>
    .calculator-container {
      max-width: 720px;
      margin: 2rem auto;
      background: var(--bg, #fff);
      border-radius: 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      padding: 2rem;
      text-align: center;
    }
    input[type="text"], input[type="number"] {
      padding: 10px;
      width: 70%;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-top: .8rem;
    }
    button {
      padding: 10px 20px;
      background: #2563eb;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-left: .5rem;
    }
    button:hover { background: #1d4ed8; }
    .suggestions {
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 8px;
      width: 70%;
      margin: 0 auto;
      text-align: left;
      max-height: 220px;
      overflow-y: auto;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      z-index: 20;
    }
    .suggestions div {
      padding: 8px 10px;
      cursor: pointer;
    }
    .suggestions div:hover {
      background: #f1f5f9;
    }
    .result-card {
      background: #f9fafb;
      padding: 1rem;
      border-radius: 10px;
      margin-top: 1.5rem;
      text-align: left;
    }
    .serving-input {
      margin-top: 1rem;
      font-size: .95rem;
    }
    .serving-input input {
      padding: 4px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-left: .5rem;
      width: 100px;
    }
    .about-section {
      text-align: left;
      margin-top: 2rem;
      line-height: 1.6;
    }
    body.dark {
      --bg: #1e293b;
      color: #f1f5f9;
      background: #0f172a;
    }
    body.dark input, body.dark button, body.dark .suggestions {
      background: #334155;
      color: #fff;
      border-color: #475569;
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header class="navbar">
    <div class="nav-container">
      <div class="logo">
        <a href="../index.html">
          <img src="../assets/convert-labs-icon.png" alt="Convert Labs Icon" class="logo-img" />
          <span class="brand-text">Convert Labs</span>
        </a>
      </div>
      <nav class="nav-links">
        <ul>
          <li><a href="../index.html">Home</a></li>
          <li><a href="tools.html" class="active">Tools</a></li>
          <li><a href="../guides.html">Blog</a></li>
          <li><a href="../about.html">About</a></li>
          <li><a href="../contact.html">Contact</a></li>
        </ul>
      </nav>
      <button id="themeToggle" class="theme-toggle">üåô</button>
    </div>
  </header>

  <!-- Main -->
  <main>
    <section class="calculator-container">
      <h1>üî• Calorie Calculator</h1>
      <p>Search thousands of foods to estimate calories, protein, carbs, sugar, and fat per 100 g serving.</p>

      <div style="position: relative;">
        <input type="text" id="foodInput" placeholder="Enter food name (e.g., chicken breast, rice, falafel)" />
        <button id="searchBtn">Search</button>
        <div id="suggestions" class="suggestions" style="display:none;"></div>
      </div>

      <div class="serving-input">
        <label for="servingSize"><strong>Serving Size (grams):</strong></label>
        <input type="number" id="servingSize" value="100" min="1" />
      </div>

      <div id="resultContainer"></div>

      <div class="about-section">
        <h2>About This Tool</h2>
        <p>
          This calorie calculator retrieves real food data from the official USDA nutrient database (2021‚Äì2023 FNDDS).
          Each result includes the energy (kcal) and macronutrients per 100 g of edible portion.
        </p>
        <ul>
          <li>‚ö° <strong>Calories (kcal)</strong> ‚Äî energy per 100 g</li>
          <li>üçó <strong>Protein</strong> ‚Äî grams of protein</li>
          <li>ü•ñ <strong>Carbs</strong> ‚Äî grams of carbohydrate</li>
          <li>ü•ë <strong>Fat</strong> ‚Äî grams of total fat</li>
          <li>üçØ <strong>Sugar</strong> ‚Äî grams of total sugars</li>
        </ul>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-brand">
      <img src="../assets/convert-labs-icon.png" alt="Convert Labs Icon" class="footer-logo" />
      <span class="footer-text">Convert Labs</span>
    </div>
    <p>¬© 2025 Convert Labs. All rights reserved.</p>
    <nav class="footer-links">
      <a href="../about.html">About</a> |
      <a href="tools.html">Tools</a> |
      <a href="../privacy.html">Privacy Policy</a> |
      <a href="../terms.html">Terms</a> |
      <a href="../contact.html">Contact</a>
    </nav>
  </footer>

  <!-- Script -->
    <style>
    body.dark {
      --bg: #1e293b;
      color: #f1f5f9;
      background: #0f172a;
    }
    body.dark input, body.dark button, body.dark .suggestions, body.dark .result-card {
      background: #334155;
      color: #f1f5f9;
      border-color: #475569;
    }
    body.dark .result-card p, 
    body.dark .result-card h3, 
    body.dark .about-section, 
    body.dark .about-section h2, 
    body.dark .about-section li {
      color: #f1f5f9;
    }
  </style>

<!-- Load Chart.js safely from CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<script>
window.addEventListener("DOMContentLoaded", () => {

  const themeBtn = document.getElementById("themeToggle");
  const foodInput = document.getElementById("foodInput");
  const servingInput = document.getElementById("servingSize");
  const suggestionsBox = document.getElementById("suggestions");
  const resultContainer = document.getElementById("resultContainer");
  const searchBtn = document.getElementById("searchBtn");
  let foodData = [];
  let currentFood = null;
  let chart = null;

  // Load datasets
  Promise.all([
    fetch("../assets/usda_food_nutrition.json").then(r => r.json()),
    fetch("../assets/food-nutrition-data.json").then(r => r.json()).catch(() => []),
    fetch("../assets/extras-oriental-foods.json").then(r => r.json()).catch(() => [])
  ])
  .then(dataArrays => { foodData = dataArrays.flat(); });

  // Theme toggle
  themeBtn.addEventListener("click", () => {
    document.body.classList.toggle("dark");
    themeBtn.textContent = document.body.classList.contains("dark") ? "‚òÄÔ∏è" : "üåô";
    if (chart) updateChartColors(); // auto update colors when theme toggles
  });

  function fuzzyMatch(term, target) {
    term = term.toLowerCase();
    target = target.toLowerCase();
    return target.includes(term) || target.replace(/[^a-z]/g, "").includes(term.replace(/[^a-z]/g, ""));
  }

  // Suggestions dropdown
  foodInput.addEventListener("input", () => {
    const term = foodInput.value.trim().toLowerCase();
    if (!term) return suggestionsBox.style.display = "none";
    const matches = foodData.filter(item => fuzzyMatch(term, item.name)).slice(0, 8);
    if (!matches.length) return suggestionsBox.style.display = "none";

    suggestionsBox.innerHTML = matches.map(m => `<div>${m.name}</div>`).join("");
    suggestionsBox.style.display = "block";
  });

  suggestionsBox.addEventListener("click", e => {
    if (e.target.tagName === "DIV") {
      foodInput.value = e.target.textContent;
      suggestionsBox.style.display = "none";
      searchFood();
    }
  });

  searchBtn.addEventListener("click", searchFood);

  function searchFood() {
    const term = foodInput.value.trim().toLowerCase();
    const match = foodData.find(item => item.name.toLowerCase() === term)
      || foodData.find(item => fuzzyMatch(term, item.name));

    if (!match) {
      resultContainer.innerHTML = `<p style="color:#b91c1c;">‚ùå No results for <strong>${term}</strong>.</p>`;
      currentFood = null;
      if (chart) chart.destroy();
      return;
    }

    currentFood = match;
    displayResult(match);
  }

  function displayResult(food) {
    const serving = parseFloat(servingInput.value) || 100;
    const factor = serving / 100;
    const scaled = {
      kcal: food.kcal * factor,
      protein: food.protein * factor,
      carbs: food.carbs * factor,
      fat: food.fat * factor,
      sugar: food.sugar * factor
    };

    resultContainer.innerHTML = `
      <div class="result-card">
        <h3>${food.name}</h3>
        <p><strong>Serving Size:</strong> ${serving} g</p>
        <p><strong>Calories:</strong> ${scaled.kcal.toFixed(1)} kcal</p>
        <p><strong>Protein:</strong> ${scaled.protein.toFixed(1)} g</p>
        <p><strong>Carbs:</strong> ${scaled.carbs.toFixed(1)} g</p>
        <p><strong>Fat:</strong> ${scaled.fat.toFixed(1)} g</p>
        <p><strong>Sugar:</strong> ${scaled.sugar.toFixed(1)} g</p>
        <canvas id="nutrientChart" height="120"></canvas>
        <button id="clearBtn" style="margin-top:1rem;background:#ef4444;">Clear</button>
      </div>
    `;

    drawChart(scaled);

    document.getElementById("clearBtn").addEventListener("click", () => {
      foodInput.value = "";
      servingInput.value = 100;
      resultContainer.innerHTML = "";
      if (chart) chart.destroy();
    });
  }

  function drawChart(data) {
    const ctx = document.getElementById("nutrientChart").getContext("2d");
    if (chart) chart.destroy();

    const darkMode = document.body.classList.contains("dark");
    const textColor = darkMode ? "#f1f5f9" : "#111";
    const barColor = darkMode ? "#60a5fa" : "#2563eb";

    chart = new Chart(ctx, {
      type: "bar",
      data: {
        labels: ["Calories", "Protein", "Carbs", "Fat", "Sugar"],
        datasets: [{
          label: "Per Serving",
          data: [data.kcal, data.protein, data.carbs, data.fat, data.sugar],
          borderRadius: 6,
          backgroundColor: barColor
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: {
          x: { ticks: { color: textColor } },
          y: { beginAtZero: true, ticks: { color: textColor } }
        }
      }
    });
  }

  function updateChartColors() {
    if (!chart) return;
    const darkMode = document.body.classList.contains("dark");
    const textColor = darkMode ? "#f1f5f9" : "#111";
    const barColor = darkMode ? "#60a5fa" : "#2563eb";
    chart.data.datasets[0].backgroundColor = barColor;
    chart.options.scales.x.ticks.color = textColor;
    chart.options.scales.y.ticks.color = textColor;
    chart.update();
  }

  servingInput.addEventListener("input", () => {
    if (currentFood) displayResult(currentFood);
  });
});
</script>

</body>
</html>
