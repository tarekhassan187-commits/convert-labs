<!doctype html>
<html lang="en">
<head>
  <!-- ‚úÖ Social Meta -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calorie Calculator ‚Äî Convert Labs</title>
  <meta name="description" content="Estimate calories, protein, carbs, sugar, and fat for thousands of foods from the USDA database." />
  <link rel="icon" href="https://convertlabs.online/assets/convert-labs-icon.png" />
  <meta name="theme-color" content="#1e40af" />
  <link rel="stylesheet" href="https://convertlabs.online/style.css" />

  <!-- Open Graph -->
  <meta property="og:title" content="Calorie Calculator ‚Äî Convert Labs" />
  <meta property="og:description" content="Estimate calories, protein, carbs, fat, and sugar for thousands of foods using Convert Labs‚Äô free calorie calculator ‚Äî powered by USDA data." />
  <meta property="og:image" content="https://convertlabs.online/assets/guide-calories.png" />
  <meta property="og:url" content="https://convertlabs.online/tools/calorie-calculator.html" />
  <meta property="og:type" content="website" />

  <!-- AdSense & Analytics (kept as requested) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2490597435056272" crossorigin="anonymous"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z88B03WV7P"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-Z88B03WV7P');
  </script>

  <!-- Breadcrumb JSON-LD -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://convertlabs.online/" },
      { "@type": "ListItem", "position": 2, "name": "Tools", "item": "https://convertlabs.online/tools/tools.html" },
      { "@type": "ListItem", "position": 3, "name": "Calorie Calculator" }
    ]
  }
  </script>

  <style>
    /* ---------- Layout & base ---------- */
    :root {
      --brand-blue: #2563eb;
      --brand-blue-dark: #1e40af;
      --card-bg: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --radius: 12px;
    }
    body {
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 0;
      background: #f7fafc;
      color: var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    header.navbar {
      background: var(--brand-blue-dark);
      color: #fff;
      padding: 12px 0;
      position: sticky;
      top: 0;
      z-index: 900;
    }
    .nav-container {
      width: 92%;
      max-width: 1100px;
      margin: 0 auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .nav-links ul{ display:flex; gap:18px; list-style:none; margin:0; padding:0; align-items:center; }
    .nav-links a{ color:#f8fafc; text-decoration:none; font-weight:500; }
    .brand { display:flex; align-items:center; gap:10px; color:#fff; font-weight:700; text-decoration:none; }

    main { padding: 28px 0 60px; }

    /* calculator card */
    .calculator-wrap { max-width:920px; margin: 24px auto; padding: 28px; border-radius: 14px; background: #fff; box-shadow: 0 10px 30px rgba(2,6,23,0.06); }
    .calculator-inner { max-width:820px; margin:auto; padding: 20px; border-radius: 12px; background: var(--card-bg); box-shadow: 0 6px 18px rgba(2,6,23,0.06); }

    h1 { margin:0 0 14px; color:#0f172a; font-size:1.9rem; display:flex; align-items:center; gap:10px; }
    p.lead { margin: 8px 0 18px; color:var(--muted); }

    /* input row */
    .search-row { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    #foodInput { padding:10px 12px; border-radius:8px; border:1px solid #e6edf3; width: 380px; box-sizing:border-box; font-size:15px; }
    #searchBtn { padding:9px 14px; border-radius:8px; background:var(--brand-blue); color:#fff; border:none; cursor:pointer; font-weight:600; }
    #searchBtn:hover { background:var(--brand-blue-dark); }

    .serving-input { margin-top:18px; display:flex; gap:12px; align-items:center; }
    #servingSize { width:120px; padding:8px 10px; border-radius:8px; border:1px solid #e6edf3; }

    /* suggestions dropdown - placed absolutely under the input */
    .search-field {
      position:relative;
      display:inline-block;
    }
    .suggestions {
      position:absolute;
      top:calc(100% + 8px);
      left:0;
      right:auto;
      min-width:340px;
      max-width:760px;
      background:#fff;
      border:1px solid #e6edf3;
      border-radius:10px;
      box-shadow:0 8px 24px rgba(2,6,23,0.08);
      max-height:300px;
      overflow:auto;
      z-index:1200;
      display:none;
    }
    .suggestions .item { padding:10px 14px; cursor:pointer; border-bottom:1px solid #f1f5f9; }
    .suggestions .item:hover { background:#f1f5f9; }
    .suggestions .item strong { color:var(--brand-blue); }
    .suggestions .show-more { display:block; padding:12px; text-align:center; background:var(--brand-blue); color:#fff; cursor:pointer; border-radius:0 0 10px 10px; margin-top:0; font-weight:600; }

    /* result card & chart */
    .result-card { margin-top:18px; padding:16px; border-radius:10px; background:#f8fafc; border:1px solid #e6edf3; }
    .chart-container { height:260px; margin-top:12px; }

    /* action buttons */
    .actions { margin-top:12px; display:flex; gap:10px; }
    .btn-green { background:#16a34a; color:#fff; padding:8px 12px; border-radius:8px; border:none; cursor:pointer; }
    .btn-red { background:#dc2626; color:#fff; padding:8px 12px; border-radius:8px; border:none; cursor:pointer; }

    /* daily summary */
    .result-summary { margin-top:14px; padding:12px; border-radius:10px; background:#f8fafc; border:1px solid #e6edf3; display:none; }

    /* about section (kept at bottom of card) */
    .about { margin-top:18px; color:var(--muted); font-size:0.96rem; }

    footer.footer { margin-top:36px; background:#1e3a8a; color:#fff; padding:26px 0; text-align:center; }

    /* responsive */
    @media (max-width:900px){
      #foodInput { width: 100%; min-width: 0; }
      .suggestions { min-width: calc(100% - 40px); left:0; right:0; }
      .calculator-wrap { margin: 18px; }
    }

    /* ==========================
       DARK MODE FIXED
       ========================== */
    :root { --dark-bg: #0b1220; --card-dark: #162138; --inner-card: #111827; --muted-dark: #94a3b8; }

    body.dark {
      background: var(--dark-bg);
      color: #e6eef8;
    }

    body.dark header.navbar { background:#0f172a; }
    body.dark .nav-links a{ color:#cbd5e1; }
    body.dark .calculator-wrap { background:transparent; box-shadow:none; }
    body.dark .calculator-inner {
      background: var(--card-dark);
      color: #e6eef8;
      box-shadow: 0 10px 30px rgba(2,6,23,0.6);
      border: 1px solid rgba(255,255,255,0.02);
    }
    body.dark h1 { color:#e6eef8; }
    body.dark p.lead { color: var(--muted-dark); }

    body.dark #foodInput,
    body.dark #servingSize,
    body.dark .suggestions,
    body.dark .result-card,
    body.dark .result-summary {
      background: #0f172a;
      color:#e6eef8;
      border:1px solid #233142;
    }

    body.dark #foodInput::placeholder { color:#94a3b8; }
    body.dark #searchBtn { background:#3b82f6; }
    body.dark #searchBtn:hover { background:#2563eb; }

    body.dark .suggestions { box-shadow: 0 8px 30px rgba(0,0,0,0.6); border-color:#233142; }
    body.dark .suggestions .item { border-bottom:1px solid #233142; }
    body.dark .suggestions .item:hover { background:#1e293b; }
    body.dark .suggestions .show-more { background:#3b82f6; color:#fff; }

    body.dark .result-card, body.dark .result-summary { background:#111827; border-color:#233142; }
    body.dark .btn-green { background:#16a34a; }
    body.dark .btn-red { background:#dc2626; }

    body.dark footer.footer { background:#0f172a; color:#e2e8f0; }

    /* modal */
    .results-modal-overlay {
      position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(2,6,23,0.45);
      z-index:1400;
    }
    .results-modal {
      width:94%; max-width:820px; max-height:82vh; border-radius:12px; overflow:hidden; background:#fff; box-shadow: 0 12px 40px rgba(2,6,23,0.3);
      display:flex; flex-direction:column;
    }
    .results-modal-header { padding:14px 16px; background:#f8fafc; border-bottom:1px solid #e6edf3; font-weight:700; position:sticky; top:0; z-index:5; }
    .results-modal-content { padding:8px 12px; overflow:auto; }
    .suggestion-item { padding:10px 12px; border-bottom:1px solid #f1f5f9; cursor:pointer; }
    .results-modal-footer { padding:10px 12px; background:#f8fafc; text-align:right; border-top:1px solid #e6edf3; position:sticky; bottom:0; z-index:5; }

    body.dark .results-modal { background:#0f172a; color:#e6eef8; box-shadow:0 12px 44px rgba(0,0,0,0.7); }
    body.dark .results-modal-header, body.dark .results-modal-footer { background:#111827; border-color:#233142; }
    body.dark .suggestion-item { border-bottom:1px solid #233142; }
    body.dark .suggestion-item:hover { background:#1e293b; }

    /* small visual tweaks */
    .muted { color:var(--muted); font-size:0.95rem; }
  </style>
</head>
<body>
  <header class="navbar">
    <div class="nav-container">
      <a class="brand" href="/index.html">
        <img src="https://convertlabs.online/assets/convert-labs-icon.png" alt="Convert Labs" style="width:36px;height:36px;border-radius:6px;background:#fff;padding:4px;">
        <span>Convert Labs</span>
      </a>
      <nav class="nav-links" aria-label="Primary">
        <ul>
          <li><a href="https://convertlabs.online/index.html">Home</a></li>
          <li><a href="https://convertlabs.online/tools/tools.html" class="active">Tools</a></li>
          <li><a href="https://convertlabs.online/guides.html">Blog</a></li>
          <li><a href="https://convertlabs.online/about.html">About</a></li>
          <li><a href="https://convertlabs.online/contact.html">Contact</a></li>
        </ul>
      </nav>
      <button id="themeToggle" title="Toggle theme" style="background:transparent;border:none;color:#f8fafc;font-size:20px;cursor:pointer;">üåô</button>
    </div>
  </header>

  <main>
    <section class="calculator-wrap">
      <div class="calculator-inner" role="region" aria-label="Calorie Calculator">
        <h1>üî• <span>Calorie Calculator</span></h1>
        <p class="lead">Search thousands of foods to estimate calories, protein, carbs, sugar, and fat per 100 g serving.</p>

        <div class="search-row" style="margin-bottom:6px;">
          <div class="search-field" aria-haspopup="listbox">
            <input id="foodInput" type="text" placeholder="Enter food name (e.g., chicken, rice, falafel)" autocomplete="off" aria-label="Food name">
            <div id="suggestions" class="suggestions" role="listbox" aria-label="Search suggestions"></div>
          </div>

          <button id="searchBtn" aria-label="Search">Search</button>
        </div>

        <div class="serving-input">
          <label for="servingSize" style="font-weight:600;">Serving Size (grams):</label>
          <input id="servingSize" type="number" min="1" value="100" aria-label="Serving size in grams">
        </div>

        <!-- Results will be injected here -->
        <div id="resultContainer" aria-live="polite"></div>

        <!-- Daily Summary -->
        <section id="dailySummary" class="result-summary" aria-hidden="true">
          <h3 style="margin:0 0 8px">Daily Summary</h3>
          <div id="dailyTotals" style="font-size:0.98rem;"></div>
          <div style="margin-top:10px;">
            <button id="clearAllBtn" class="btn-red" style="background:#ef4444;">Clear All</button>
          </div>
        </section>

        <!-- About this tool -->
        <div class="about" style="margin-top:20px;">
          <strong style="display:block;margin-bottom:8px;color:inherit">About This Tool</strong>
          <p class="muted">This calorie calculator retrieves real food data from the official USDA nutrient database (2021‚Äì2023 FNDDS). Each result includes the energy (kcal) and macronutrients per 100 g of edible portion. Use the serving size input to scale values to your portion.</p>
          <ul style="margin:12px 0 0 18px;color:var(--muted);">
            <li>‚ö° <strong>Calories (kcal)</strong> ‚Äî energy per 100 g</li>
            <li>üçó <strong>Protein</strong> ‚Äî grams of protein</li>
            <li>ü•ñ <strong>Carbs</strong> ‚Äî grams of carbohydrate</li>
            <li>ü•ë <strong>Fat</strong> ‚Äî grams of total fat</li>
            <li>üçØ <strong>Sugar</strong> ‚Äî grams of total sugars</li>
          </ul>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer" role="contentinfo">
    <div style="max-width:1100px;margin:0 auto;">
      <div style="margin-bottom:8px;">
        <img src="https://convertlabs.online/assets/convert-labs-icon.png" alt="" style="width:38px;height:38px;vertical-align:middle;margin-right:6px;">
        <span style="vertical-align:middle;">Convert Labs</span>
      </div>
      <p style="margin:6px 0 10px">¬© 2025 Convert Labs. All rights reserved.</p>
      <div class="footer-links">
        <a href="https://convertlabs.online/about.html">About</a> |
        <a href="https://convertlabs.online/tools/tools.html">Tools</a> |
        <a href="https://convertlabs.online/guides.html">Blog</a> |
        <a href="https://convertlabs.online/privacy.html">Privacy</a> |
        <a href="https://convertlabs.online/disclaimer.html">Disclaimer</a> |
        <a href="https://convertlabs.online/terms.html">Terms</a> |
        <a href="https://convertlabs.online/contact.html">Contact</a>
      </div>
    </div>
  </footer>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <script>
  // Theme persistence + toggle
  (function(){
    const btn = document.getElementById('themeToggle');
    function setTheme(mode){
      if(mode === 'dark'){ document.documentElement.classList.add('dark'); document.body.classList.add('dark'); btn.textContent='‚òÄÔ∏è'; }
      else { document.documentElement.classList.remove('dark'); document.body.classList.remove('dark'); btn.textContent='üåô'; }
      try{ localStorage.setItem('cl_theme', mode); }catch(e){}
    }
    try{
      const saved = localStorage.getItem('cl_theme');
      if(saved) setTheme(saved);
      else setTheme(window.matchMedia && window.matchMedia('(prefers-color-scheme:dark)').matches ? 'dark' : 'light');
    }catch(e){ setTheme('light'); }
    btn.addEventListener('click', ()=>{
      const dark = document.body.classList.contains('dark');
      setTheme(dark ? 'light' : 'dark');
      if(window.updateChartColors) window.updateChartColors();
    });
  })();
  </script>

  <script>
  (function(){
    // Elements
    const foodInput = document.getElementById('foodInput');
    const searchBtn = document.getElementById('searchBtn');
    const suggestionsBox = document.getElementById('suggestions');
    const servingSize = document.getElementById('servingSize');
    const resultContainer = document.getElementById('resultContainer');
    const dailySummary = document.getElementById('dailySummary');
    const dailyTotalsDiv = document.getElementById('dailyTotals');
    const clearAllBtn = document.getElementById('clearAllBtn');

    let foodData = [], foodIndex = [];
    let currentFood = null;
    let chart = null;
    let dailyTotals = { kcal:0, protein:0, carbs:0, fat:0, sugar:0 };

    // Fetch datasets
    Promise.all([
      fetch('https://convertlabs.online/assets/usda_food_nutrition.json').then(r=>r.json()).catch(()=>[]),
      fetch('https://convertlabs.online/assets/extras-oriental-foods.json').then(r=>r.json()).catch(()=>[]),
      fetch('https://convertlabs.online/assets/foods-full.json').then(r=>r.json()).catch(()=>[]),
      fetch('https://convertlabs.online/assets/foods-lite.json').then(r=>r.json()).catch(()=>[])
    ]).then(arrs=>{
      const combined = arrs.flat();
      const seen = new Set();
      foodData = combined.filter(it => {
        const key = ((it.name||it.food)||'').toLowerCase().trim();
        if(!key) return false;
        if(seen.has(key)) return false;
        seen.add(key);
        return true;
      });
      buildIndex(foodData);
      console.log('Food data loaded:', foodData.length);
    }).catch(err=>{
      console.error('Failed to load food JSONs', err);
    });

    // Build simple search index
    function normalizeText(s){
      return String(s||'').normalize('NFKD').replace(/\p{Diacritic}/gu,'').toLowerCase().trim();
    }
    function buildIndex(data){
      foodIndex = data.map(item=>{
        const name = item.name || item.food || '';
        const norm = normalizeText(name);
        const tokens = Array.from(new Set(norm.split(/\s+/).filter(Boolean)));
        return { name, norm, tokens, original:item };
      });
    }

    // Scoring function
    function scoreItem(qNorm, item){
      const n = item.norm;
      if(n === qNorm) return 100;
      if(n.startsWith(qNorm)) return 85;
      if(item.tokens.includes(qNorm)) return 75;
      if(n.includes(qNorm)) return 55;
      return 0;
    }

    function getSuggestions(q, max=20){
      const qNorm = normalizeText(q);
      if(!qNorm) return { results:[], total:0 };
      const scored = [];
      for(const item of foodIndex){
        const s = scoreItem(qNorm, item);
        if(s>0) scored.push({item,score:s});
      }
      scored.sort((a,b)=>b.score - a.score);
      const total = scored.length;
      return { results: scored.slice(0,max).map(s=>s.item), total };
    }

    // Highlight helper (returns HTML)
    function highlightMatch(text, q){
      const norm = normalizeText(text);
      const nq = normalizeText(q);
      const idx = norm.indexOf(nq);
      if(idx === -1) return text;
      const before = text.slice(0, idx);
      const match = text.slice(idx, idx + nq.length);
      const after = text.slice(idx + nq.length);
      return `${before}<strong>${match}</strong>${after}`;
    }

    // Render suggestions
    function renderSuggestions(q){
      const { results, total } = getSuggestions(q);
      if(!results.length){ suggestionsBox.style.display='none'; return; }
      const items = results.map(r=>`<div class="item" role="option">${highlightMatch(r.name, q)}</div>`).join('');
      let html = items;
      if(total > results.length){
        html += `<div class="show-more" role="button" tabindex="0">üîç Show all ${total} results for ‚Äú${q}‚Äù</div>`;
      }
      suggestionsBox.innerHTML = html;
      suggestionsBox.style.display = 'block';
      // reposition width to match input on small screens: suggestions uses min-width, but keep it simple
    }

    // Show full results modal
    function showFullResults(q){
      const { results, total } = getSuggestions(q, 1000);
      const overlay = document.createElement('div');
      overlay.className = 'results-modal-overlay';
      overlay.addEventListener('click', (ev)=>{ if(ev.target === overlay) closeModal(); });

      const modal = document.createElement('div');
      modal.className = 'results-modal';
      modal.setAttribute('role','dialog');
      modal.setAttribute('aria-label','All search results');
      modal.innerHTML = `
        <div class="results-modal-header">All ${total} results for ‚Äú${q}‚Äù</div>
        <div class="results-modal-content"></div>
        <div class="results-modal-footer"><button id="closeModalBtn" style="padding:8px 14px;border-radius:8px;border:none;background:var(--brand-blue);color:#fff;cursor:pointer">Close</button></div>
      `;
      overlay.appendChild(modal);
      document.body.appendChild(overlay);

      const content = modal.querySelector('.results-modal-content');
      if(results.length === 0) content.innerHTML = '<p style="padding:12px">No results found.</p>';
      else content.innerHTML = results.map(r => `<div class="suggestion-item" tabindex="0">${r.name}</div>`).join('');

      // Bind clicks
      content.querySelectorAll('.suggestion-item').forEach(node=>{
        node.addEventListener('click', ()=>{
          foodInput.value = node.textContent.trim();
          suggestionsBox.style.display = 'none';
          closeModal();
          searchFood();
        });
      });

      document.getElementById('closeModalBtn').addEventListener('click', closeModal);

      // ESC support
      function escHandler(e){ if(e.key === 'Escape') closeModal(); }
      window.addEventListener('keydown', escHandler);

      function closeModal(){
        window.removeEventListener('keydown', escHandler);
        if(overlay.parentNode) overlay.parentNode.removeChild(overlay);
      }
    }

    // click on suggestions
    suggestionsBox.addEventListener('click', (e)=>{
      const target = e.target.closest('.item');
      if(!target) {
        if(e.target.classList.contains('show-more')) {
          showFullResults(foodInput.value.trim());
        }
        return;
      }
      // get textContent (strip HTML)
      const name = target.textContent.trim();
      foodInput.value = name;
      suggestionsBox.style.display = 'none';
      searchFood();
    });

    // keyboard accessibility for show-more inside suggestions
    suggestionsBox.addEventListener('keydown', (e)=>{
      const t = e.target;
      if(t && t.classList && t.classList.contains('show-more') && (e.key === 'Enter' || e.key === ' ')) {
        e.preventDefault();
        showFullResults(foodInput.value.trim());
      }
    });

    // debounce input
    let debounce;
    foodInput.addEventListener('input', (e)=>{
      const q = e.target.value.trim();
      clearTimeout(debounce);
      if(!q){ suggestionsBox.style.display='none'; return; }
      debounce = setTimeout(()=> renderSuggestions(q), 180);
    });

    // ensure suggestions close when clicking outside
    document.addEventListener('click', (e)=>{
      if(!e.target.closest('.search-field')) suggestionsBox.style.display='none';
    });

    // search button and Enter key
    searchBtn.addEventListener('click', searchFood);
    foodInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter'){ e.preventDefault(); searchFood(); } });

    // main search logic
    function searchFood(){
      const term = (foodInput.value || '').trim();
      if(!term){ resultContainer.innerHTML=''; currentFood = null; return; }
      const lower = term.toLowerCase();
      // try exact match first
      let match = foodData.find(it => ((it.name||it.food)||'').toLowerCase() === lower);
      if(!match) match = foodData.find(it => ((it.name||it.food)||'').toLowerCase().includes(lower));
      if(!match){
        resultContainer.innerHTML = `<div class="result-card"><p style="color:#b91c1c;margin:0">‚ùå No results for <strong>${escapeHtml(term)}</strong>.</p></div>`;
        currentFood = null;
        if(chart) { chart.destroy(); chart = null; }
        return;
      }
      currentFood = match;
      displayResult(match);
    }

    // display result
    function displayResult(food){
      const serving = Number(servingSize.value) || 100;
      const factor = serving / 100;
      const scaled = {
        kcal: (Number(food.kcal) || 0) * factor,
        protein: (Number(food.protein) || 0) * factor,
        carbs: (Number(food.carbs) || 0) * factor,
        fat: (Number(food.fat) || 0) * factor,
        sugar: (Number(food.sugar) || 0) * factor
      };

      resultContainer.innerHTML = `
        <div class="result-card" aria-live="polite">
          <h3 style="margin:0 0 8px">${escapeHtml(food.name)}</h3>
          <p style="margin:6px 0;"><strong>Serving Size:</strong> <span id="resServing">${serving}</span> g</p>
          <p style="margin:6px 0;"><strong>Calories:</strong> <span id="resKcal">${scaled.kcal.toFixed(1)}</span> kcal</p>
          <p style="margin:6px 0;"><strong>Protein:</strong> <span id="resProtein">${scaled.protein.toFixed(1)}</span> g</p>
          <p style="margin:6px 0;"><strong>Carbs:</strong> <span id="resCarbs">${scaled.carbs.toFixed(1)}</span> g</p>
          <p style="margin:6px 0;"><strong>Fat:</strong> <span id="resFat">${scaled.fat.toFixed(1)}</span> g</p>
          <p style="margin:6px 0;"><strong>Sugar:</strong> <span id="resSugar">${scaled.sugar.toFixed(1)}</span> g</p>
          <div class="chart-container"><canvas id="nutrientChart"></canvas></div>
          <div class="actions">
            <button id="addToTotalBtn" class="btn-green">Add to Daily Summary</button>
            <button id="clearBtn" class="btn-red">Clear</button>
          </div>
        </div>
      `;

      // draw chart
      drawChart(scaled);

      // bind buttons
      document.getElementById('addToTotalBtn').addEventListener('click', ()=> {
        addToDailyTotal(scaled);
      });
      document.getElementById('clearBtn').addEventListener('click', ()=> {
        foodInput.value = '';
        servingSize.value = 100;
        resultContainer.innerHTML = '';
        currentFood = null;
        if(chart){ chart.destroy(); chart = null; }
      });
    }

    // draw Chart.js
    function drawChart(data){
      const ctx = document.getElementById('nutrientChart');
      if(!ctx) return;
      if(chart) chart.destroy();
      const dark = document.body.classList.contains('dark');
      const textColor = dark ? '#e6eef8' : '#111827';
      const barColor = dark ? '#60a5fa' : '#2563eb';
      chart = new Chart(ctx.getContext('2d'), {
        type: 'bar',
        data: {
          labels: ['Calories','Protein','Carbs','Fat','Sugar'],
          datasets: [{ data: [data.kcal, data.protein, data.carbs, data.fat, data.sugar], backgroundColor: barColor, borderRadius:6 }]
        },
        options: {
          responsive:true,
          maintainAspectRatio:false,
          plugins:{ legend:{ display:false } },
          scales:{
            x: { ticks: { color: textColor } },
            y: { beginAtZero:true, ticks: { color: textColor } }
          }
        }
      });
    }

    // make updateChartColors global so theme toggle calls it
    window.updateChartColors = function(){
      if(!chart) return;
      const dark = document.body.classList.contains('dark');
      const barColor = dark ? '#60a5fa' : '#2563eb';
      const textColor = dark ? '#e6eef8' : '#111827';
      chart.data.datasets[0].backgroundColor = barColor;
      chart.options.scales.x.ticks.color = textColor;
      chart.options.scales.y.ticks.color = textColor;
      chart.update();
    };

    // Add to daily totals
    function addToDailyTotal(data){
      for(const k of Object.keys(dailyTotals)) {
        dailyTotals[k] = (dailyTotals[k] || 0) + (data[k] || 0);
      }
      updateDailySummary();
    }
    function updateDailySummary(){
      dailySummary.style.display = 'block';
      dailySummary.setAttribute('aria-hidden','false');
      dailyTotalsDiv.innerHTML = `
        <p style="margin:6px 0"><strong>Calories:</strong> ${dailyTotals.kcal.toFixed(1)} kcal</p>
        <p style="margin:6px 0"><strong>Protein:</strong> ${dailyTotals.protein.toFixed(1)} g</p>
        <p style="margin:6px 0"><strong>Carbs:</strong> ${dailyTotals.carbs.toFixed(1)} g</p>
        <p style="margin:6px 0"><strong>Fat:</strong> ${dailyTotals.fat.toFixed(1)} g</p>
        <p style="margin:6px 0"><strong>Sugar:</strong> ${dailyTotals.sugar.toFixed(1)} g</p>
      `;
    }

    clearAllBtn.addEventListener('click', ()=>{
      dailyTotals = { kcal:0, protein:0, carbs:0, fat:0, sugar:0 };
      dailySummary.style.display = 'none';
      dailySummary.setAttribute('aria-hidden','true');
    });

    // update serving size live if there's an active result
    servingSize.addEventListener('input', ()=>{
      if(!currentFood) return;
      // update displayed numbers
      displayResult(currentFood);
    });

    // helpers
    function escapeHtml(s){
      return String(s || '').replace(/[&<>"]/g, function(c){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]; });
    }

    // keyboard: close suggestions with Escape
    window.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape') suggestionsBox.style.display='none';
    });

  })();
  </script>
</body>
</html>
