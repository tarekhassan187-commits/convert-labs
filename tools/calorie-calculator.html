<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ‚úÖ Social Meta -->
  <meta property="og:title" content="Calorie Calculator ‚Äî Convert Labs" />
  <meta property="og:description" content="Estimate calories, protein, carbs, fat, and sugar for thousands of foods using Convert Labs‚Äô free calorie calculator ‚Äî powered by USDA data." />
  <meta property="og:image" content="https://convertlabs.online/assets/guide-calories.png" />
  <meta property="og:url" content="https://convertlabs.online/tools/calorie-calculator.html" />
  <meta property="og:type" content="website" />

  <!-- ‚úÖ AdSense & Analytics -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2490597435056272" crossorigin="anonymous"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z88B03WV7P"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-Z88B03WV7P');
  </script>

  <!-- ‚úÖ Breadcrumb JSON-LD -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://convertlabs.online/" },
      { "@type": "ListItem", "position": 2, "name": "Tools", "item": "https://convertlabs.online/tools/tools.html" },
      { "@type": "ListItem", "position": 3, "name": "Calorie Calculator" }
    ]
  }
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Calorie Calculator ‚Äî Convert Labs</title>
  <meta name="description" content="Estimate calories, protein, carbs, sugar, and fat for thousands of foods from the USDA database." />
  <link rel="icon" href="https://convertlabs.online/assets/convert-labs-icon.png" />
  <link rel="stylesheet" href="https://convertlabs.online/style.css" />
  <meta name="theme-color" content="#1e40af" />

  <style>
    /* ---------- Base UI ---------- */
    .calculator-container {
      max-width: 900px;
      margin: 120px auto;
      padding: 2rem;
      background: var(--card-bg, #fff);
      border-radius: 12px;
      box-shadow: 0 2px 14px rgba(0,0,0,0.06);
      color: var(--text, #111);
    }

    h1 { color: #1e3a8a; margin-top: 0; }
    input[type="text"], input[type="number"] {
      padding: 10px;
      width: 70%;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-top: 0.6rem;
      box-sizing: border-box;
      font-size: 15px;
    }
    #foodInput { width: 280px; } /* override for desktop (responsive below) */

    button, .theme-toggle {
      background: #2563eb;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 10px 16px;
      cursor: pointer;
      font-size: 15px;
    }
    button:hover { background: #1d4ed8; }

    .serving-input { margin-top: 1rem; }
    .serving-input input { width: 150px; padding: 8px; }

    .suggestions {
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 8px;
      width: 70%;
      margin: 6px auto 0;
      text-align: left;
      max-height: 220px;
      overflow-y: auto;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
    }
    .suggestions div { padding: 8px 10px; cursor: pointer; }
    .suggestions div:hover { background: #f1f5f9; }
    .show-more { padding: 8px 10px; color: #2563eb; cursor: pointer; }

    .result-card { background: #f8fafc; padding: 1rem; border-radius: 10px; margin-top: 1.2rem; }
    .chart-container { height: 240px; margin-top: 8px; }

    footer.footer { text-align:center; padding: 24px 0; margin-top: 40px; background: transparent; color: #6b7280; }

    @media (max-width: 700px){
      .calculator-container { margin: 80px 16px; padding: 1.5rem; }
      input[type="text"], #foodInput { width: 100% !important; }
      .suggestions { left: 50%; transform: translateX(-50%); width: 92%; }
      #servingSize { width: 100%; }
    }

    /* ---------- Dark Mode ---------- */
    :root { --dark-bg: #0b1220; --card-dark: #1b2435; --inner-card: #121827; --muted: #9ca3af; }
    body.dark, html.dark { background: var(--dark-bg); color: #e6eef8; }

    /* navbar & footer dark */
    body.dark .navbar { background: var(--dark-bg) !important; border-bottom: 1px solid rgba(255,255,255,0.04); }
    body.dark .nav-links a { color: #cbd5e1 !important; }
    body.dark .nav-links a.active { color: #60a5fa !important; }

    body.dark .calculator-container { background: var(--card-dark); color: #e6eef8; box-shadow: 0 8px 30px rgba(0,0,0,0.6); }
    body.dark .result-card { background: var(--inner-card); border: 1px solid #263144; color: #e6eef8; }
    body.dark .suggestions { background: #172033; border: 1px solid #2c3b53; color: #e6eef8; }
    body.dark .suggestions div:hover { background: #263447; }
    body.dark .show-more { color: #60a5fa; }

    body.dark input[type="text"], body.dark input[type="number"] {
      background: #0f172a; color: #e6eef8; border: 1px solid #334155;
    }
    body.dark input::placeholder { color: #9ca3af; }

    body.dark button, body.dark .theme-toggle {
      background: #2563eb; color: white;
    }
    body.dark footer.footer { background: transparent; color: #94a3b8; }

    /* smooth */
    body, input, button, .calculator-container, .result-card, .suggestions { transition: background-color .22s ease, color .18s ease, border-color .18s ease, box-shadow .22s ease; }

    /* üåô Theme Fade Transition */
html, body {
  transition: background-color 0.4s ease, color 0.4s ease;
}

/* üîπ Suggestion box improvements */
.suggestions {
  background: #fff;
  border: 1px solid #ccc;
  border-radius: 10px;
  width: 70%;
  margin-top: 6px;
  text-align: left;
  max-height: 280px;
  overflow-y: auto;
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  z-index: 1000;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.suggestions div {
  padding: 10px 14px;
  cursor: pointer;
  font-size: 15px;
  border-bottom: 1px solid #f1f5f9;
}

.suggestions div:last-child {
  border-bottom: none;
}

/* üåü More results button */
.show-more {
  background: #2563eb;
  color: white !important;
  text-align: center;
  font-weight: 500;
  border-radius: 0 0 10px 10px;
  padding: 12px;
  cursor: pointer;
  transition: background 0.25s ease;
  display: block;
}

.show-more:hover {
  background: #1e40af;
}

/* üåô Dark mode version of suggestions */
body.dark .suggestions {
  background: #1e293b;
  border: 1px solid #334155;
  box-shadow: 0 4px 16px rgba(255, 255, 255, 0.06);
}
body.dark .suggestions div {
  border-bottom: 1px solid #334155;
}
body.dark .suggestions div:hover {
  background: #334155;
}
body.dark .show-more {
  background: #3b82f6;
}
body.dark .show-more:hover {
  background: #2563eb;
}
/* üåô Fix full results modal for dark mode */
body.dark .results-modal {
  background: #1e293b !important;
  color: #f1f5f9 !important;
  box-shadow: 0 0 20px rgba(0,0,0,0.6);
}

body.dark .results-modal h4 {
  color: #f8fafc !important;
}

body.dark .results-modal .suggestion-item {
  color: #e2e8f0 !important;
  border-bottom: 1px solid #334155;
}

body.dark .results-modal .suggestion-item:hover {
  background: #334155;
}

body.dark #closeModalBtn {
  background: #3b82f6 !important;
  color: #fff !important;
}
body.dark #closeModalBtn:hover {
  background: #2563eb !important;
}
/* üåü Full Results Modal ‚Äî Convert Labs Style */
.results-modal {
  background: #fff;
  color: #111;
  border-radius: 12px;
  max-width: 700px;
  width: 94%;
  max-height: 80vh;
  overflow-y: auto;
  padding: 0;
  box-shadow: 0 8px 30px rgba(0,0,0,0.25);
  animation: modalFadeIn 0.25s ease forwards;
  position: relative;
}

/* Sticky header inside modal */
.results-modal-header {
  position: sticky;
  top: 0;
  background: #f8fafc;
  padding: 16px;
  border-bottom: 1px solid #e2e8f0;
  font-weight: 600;
  z-index: 10;
}

.results-modal-content {
  padding: 12px 16px;
}

.suggestion-item {
  padding: 10px 8px;
  border-bottom: 1px solid #e2e8f0;
  cursor: pointer;
  transition: background 0.2s;
}
.suggestion-item:hover {
  background: #eff6ff;
}

.results-modal-footer {
  position: sticky;
  bottom: 0;
  background: #f8fafc;
  border-top: 1px solid #e2e8f0;
  text-align: right;
  padding: 10px 16px;
}

/* üåô Dark Mode */
body.dark .results-modal {
  background: #1e293b !important;
  color: #f1f5f9 !important;
  box-shadow: 0 0 25px rgba(0,0,0,0.6);
}
body.dark .results-modal-header,
body.dark .results-modal-footer {
  background: #111827 !important;
  border-color: #334155 !important;
}
body.dark .suggestion-item {
  border-bottom: 1px solid #334155;
}
body.dark .suggestion-item:hover {
  background: #334155;
}
body.dark #closeModalBtn {
  background: #3b82f6 !important;
  color: #fff !important;
}
body.dark #closeModalBtn:hover {
  background: #2563eb !important;
}

/* ‚ú® Smooth entry */
@keyframes modalFadeIn {
  from { opacity: 0; transform: scale(0.97); }
  to { opacity: 1; transform: scale(1); }
}
/* ‚òÄÔ∏è Light mode footer reset ‚Äî ensure text and links are visible */
body:not(.dark) footer.footer,
body:not(.dark) .footer {
  background: #f9fafb !important;   /* light gray background */
  color: #1e293b !important;         /* dark gray text */
}

body:not(.dark) .footer-links a {
  color: #2563eb !important;         /* Convert Labs blue */
  text-decoration: none;
}

body:not(.dark) .footer-links a:hover {
  text-decoration: underline;
}

body:not(.dark) .footer-text {
  color: #1e293b !important;
}
/* ‚òÄÔ∏è Light Mode Footer Styling (Dark Blue Theme) */
body:not(.dark) footer.footer,
body:not(.dark) .footer {
  background-color: #1e3a8a !important;  /* Dark Convert Labs Blue */
  color: #ffffff !important;              /* White text */
  text-align: center;
  transition: background-color 0.4s ease, color 0.4s ease;
}

body:not(.dark) .footer-links a {
  color: #bfdbfe !important;              /* Lighter blue links */
  text-decoration: none;
  transition: color 0.3s ease;
}

body:not(.dark) .footer-links a:hover {
  color: #ffffff !important;
  text-decoration: underline;
}

body:not(.dark) .footer-text {
  color: #ffffff !important;
}

/* üåô Dark Mode Footer Styling */
body.dark footer.footer,
body.dark .footer {
  background-color: #0f172a !important;   /* Deep navy */
  color: #e2e8f0 !important;
  transition: background-color 0.4s ease, color 0.4s ease;
}

body.dark .footer-links a {
  color: #60a5fa !important;
}
body.dark .footer-links a:hover {
  color: #93c5fd !important;
}


/* üåô Dark Mode Footer Styling */
body.dark footer.footer,
body.dark .footer {
  background-color: #0f172a !important;   /* Deep navy */
  color: #e2e8f0 !important;              /* Soft white */
}

body.dark .footer-links a {
  color: #60a5fa !important;              /* Soft blue links */
}
body.dark .footer-links a:hover {
  color: #93c5fd !important;
}

  </style>
</head>

<body>
  <!-- Header -->
  <header class="navbar">
    <div class="nav-container" style="display:flex;align-items:center;justify-content:space-between;padding:12px 24px;">
      <div style="display:flex;align-items:center;gap:12px">
        <a href="/index.html" style="display:flex;align-items:center;text-decoration:none;color:inherit">
          <img src="https://convertlabs.online/assets/convert-labs-icon.png" alt="Convert Labs Icon" style="width:36px;height:36px"/>
          <span style="font-weight:700;margin-left:6px;color:inherit">Convert Labs</span>
        </a>
      </div>
      <nav class="nav-links" aria-label="Main navigation">
        <ul style="display:flex;gap:18px;list-style:none;margin:0;padding:0">
          <li><a href="https://convertlabs.online/index.html">Home</a></li>
          <li><a href="https://convertlabs.online/tools/tools.html" class="active">Tools</a></li>
          <li><a href="https://convertlabs.online/guides.html">Blog</a></li>
          <li><a href="https://convertlabs.online/about.html">About</a></li>
          <li><a href="https://convertlabs.online/contact.html">Contact</a></li>
        </ul>
      </nav>
      <button id="themeToggle" class="theme-toggle" title="Toggle theme">üåô</button>
    </div>
  </header>

  <!-- Main -->
  <main>
    <section class="calculator-container">
      <h1>üî• Calorie Calculator</h1>
      <p>Search thousands of foods to estimate calories, protein, carbs, sugar, and fat per 100 g serving.</p>

      <div style="position:relative;">
        <input type="text" id="foodInput" placeholder="Enter food name (e.g., chicken breast, rice, falafel)" />
        <button id="searchBtn">Search</button>
        <div id="suggestions" class="suggestions" style="display:none;"></div>
      </div>

      <div class="serving-input">
        <label for="servingSize"><strong>Serving Size (grams):</strong></label>
        <input type="number" id="servingSize" value="100" min="1" />
      </div>

      <div id="resultContainer"></div>

      <!-- Daily Summary Card -->
      <section id="dailySummary" class="result-card" style="display:none;">
        <h3>Daily Summary</h3>
        <div id="dailyTotals"></div>
        <button id="clearAllBtn" style="margin-top:12px;background:#ef4444;color:white;border:none;padding:8px 12px;border-radius:8px;">Clear All</button>
      </section>

      <div class="about-section" style="margin-top:1.2rem">
        <h2>About This Tool</h2>
        <p>This calorie calculator retrieves real food data from the official USDA nutrient database (2021‚Äì2023 FNDDS). Each result includes the energy (kcal) and macronutrients per 100 g of edible portion.</p>
        <ul>
          <li>‚ö° <strong>Calories (kcal)</strong> ‚Äî energy per 100 g</li>
          <li>üçó <strong>Protein</strong> ‚Äî grams of protein</li>
          <li>ü•ñ <strong>Carbs</strong> ‚Äî grams of carbohydrate</li>
          <li>ü•ë <strong>Fat</strong> ‚Äî grams of total fat</li>
          <li>üçØ <strong>Sugar</strong> ‚Äî grams of total sugars</li>
        </ul>
      </div>

      <hr style="margin-top:18px;border:none;border-top:1px solid rgba(0,0,0,0.06)">
      <p style="margin-top:10px">
        Want to understand daily calorie needs and meal plans?
        <a href="https://convertlabs.online/tools/calorie-guide.html">Read our full Calorie & Nutrition Guide ‚Üí</a>
      </p>
    </section>
  </main>

   <!-- Footer -->
  <footer class="footer" role="contentinfo">
    <div class="footer-brand">
      <img src="https://convertlabs.online/convert-labs-icon.png" alt="Convert Labs Icon" class="footer-logo" />
      <span class="footer-text">Convert Labs</span>
    </div>
    <p>¬© 2025 Convert Labs. All rights reserved.</p>
    <nav class="footer-links" aria-label="Footer">
      <a href="https://convertlabs.online/about.html">About</a> |
      <a href="https://convertlabs.online/tools/tools.html">Tools</a> |
      <a href="https://convertlabs.online/guides.html">Blog</a> |
      <a href="https://convertlabs.online/privacy.html">Privacy</a> |
      <a href="https://convertlabs.online/disclaimer.html">Disclaimer</a> |
      <a href="https://convertlabs.online/terms.html">Terms of Use</a> |
      <a href="https://convertlabs.online/contact.html">Contact</a>
    </nav>
  </footer>

  <!-- Load Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <script>
  /***** theme persistence & toggle *****/
  const themeBtn = document.getElementById('themeToggle');
  function setTheme(mode){
    if(mode === 'dark'){
      document.body.classList.add('dark');
      document.documentElement.classList.add('dark');
      themeBtn.textContent = '‚òÄÔ∏è';
    } else {
      document.body.classList.remove('dark');
      document.documentElement.classList.remove('dark');
      themeBtn.textContent = 'üåô';
    }
    try { localStorage.setItem('cl_theme', mode); } catch(e){}
  }
  // init from storage (or system pref as fallback)
  (function initTheme(){
    try {
      const saved = localStorage.getItem('cl_theme');
      if(saved) { setTheme(saved); return; }
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      setTheme(prefersDark ? 'dark' : 'light');
    } catch(e) { setTheme('light'); }
  })();

  themeBtn.addEventListener('click', () => {
    const isDark = document.body.classList.contains('dark');
    setTheme(isDark ? 'light' : 'dark');
    // If charts are present, they'll need color update ‚Äî handled in code below
    if(window.updateChartColors) window.updateChartColors();
  });
  </script>

  <script>
  // ---------- existing application JS (slightly cleaned but unchanged logic) ----------
  window.addEventListener("DOMContentLoaded", () => {
    const foodInput = document.getElementById("foodInput");
    const servingInput = document.getElementById("servingSize");
    const suggestionsBox = document.getElementById("suggestions");
    const resultContainer = document.getElementById("resultContainer");
    const dailySummary = document.getElementById("dailySummary");
    const dailyTotalsDiv = document.getElementById("dailyTotals");
    const clearAllBtn = document.getElementById("clearAllBtn");
    const searchBtn = document.getElementById("searchBtn");

    let foodData = [];
    let foodIndex = [];
    let currentFood = null;
    let chart = null;
    let dailyTotals = { kcal:0, protein:0, carbs:0, fat:0, sugar:0 };

    // Load data files
    Promise.all([
      fetch("https://convertlabs.online/assets/usda_food_nutrition.json").then(r => r.json()).catch(()=>[]),
      fetch("https://convertlabs.online/assets/extras-oriental-foods.json").then(r => r.json()).catch(()=>[]),
      fetch("https://convertlabs.online/assets/foods-full.json").then(r => r.json()).catch(()=>[]),
      fetch("https://convertlabs.online/assets/foods-lite.json").then(r => r.json()).catch(()=>[])
    ]).then(dataArrays => {
      const combined = dataArrays.flat();
      const seen = new Set();
      foodData = combined.filter(item => {
        const key = (item.name || item.food || "").toLowerCase();
        if(seen.has(key)) return false;
        seen.add(key);
        return true;
      });
      console.log('‚úÖ Food data loaded:', foodData.length);
      buildIndex(foodData);
    }).catch(err => console.error('Error loading food data', err));

    // ---------- search index ----------
    function normalizeText(s){
      return String(s||"").normalize('NFKD').replace(/\p{Diacritic}/gu,'').toLowerCase().trim();
    }
    function buildIndex(data){
      foodIndex = data.map(item => {
        const name = item.name || item.food || '';
        const normName = normalizeText(name);
        const tokens = Array.from(new Set(normName.split(/\s+/).filter(Boolean)));
        return { name, normName, tokens, original: item };
      });
      console.log('üîé index built:', foodIndex.length);
    }
    function scoreItem(qNorm, item){
      const n = item.normName;
      if(n === qNorm) return 100;
      if(n.startsWith(qNorm)) return 85;
      if(item.tokens.includes(qNorm)) return 75;
      if(n.includes(qNorm)) return 55;
      return 0;
    }
    function getSuggestions(q, max = 20){
      const qNorm = normalizeText(q);
      if(!qNorm) return { results: [], total: 0 };
      const scored = [];
      for(const item of foodIndex){
        const s = scoreItem(qNorm, item);
        if(s > 0) scored.push({ item, score: s });
      }
      scored.sort((a,b) => b.score - a.score);
      return { results: scored.slice(0,max).map(s=>s.item), total: scored.length };
    }
    function highlightMatch(text, query){
      const n = normalizeText(text);
      const q = normalizeText(query);
      const idx = n.indexOf(q);
      if(idx === -1) return text;
      return `${text.slice(0, idx)}<strong style="color:#2563eb">${text.slice(idx, idx+q.length)}</strong>${text.slice(idx+q.length)}`;
    }

    function renderSuggestions(q){
      const { results, total } = getSuggestions(q);
      if(!results.length){ suggestionsBox.style.display = 'none'; return; }
      let html = results.map(r => `<div>${highlightMatch(r.name, q)}</div>`).join('');
      if (total > results.length) {
  html += `
    <div class="show-more">
      üîç Show all ${total} results for ‚Äú${q}‚Äù
    </div>
  `;
}

      suggestionsBox.innerHTML = html;
      suggestionsBox.style.display = 'block';
    }

    // show full results modal (click item closes modal and suggestions)
    function showFullResults(q) {
  const { results, total } = getSuggestions(q, 300);

  // Create modal wrapper
  const modal = document.createElement('div');
  modal.style.cssText = `
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.45);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:1200;
    backdrop-filter: blur(2px);
  `;

  // Create modal box
  const box = document.createElement('div');
  box.classList.add('results-modal');

  // Sticky header
  const header = document.createElement('div');
  header.classList.add('results-modal-header');
  header.innerHTML = `All ${total} results for ‚Äú${q}‚Äù`;

  // Scrollable content
  const content = document.createElement('div');
  content.classList.add('results-modal-content');
  content.innerHTML = results.map(r =>
    `<div class="suggestion-item">${highlightMatch(r.name, q)}</div>`
  ).join('');

  // Sticky footer
  const footer = document.createElement('div');
  footer.classList.add('results-modal-footer');
  footer.innerHTML = `<button id="closeModalBtn" style="padding:8px 14px;border:none;border-radius:8px;background:#2563eb;color:white;cursor:pointer;">Close</button>`;

  // Assemble modal
  box.appendChild(header);
  box.appendChild(content);
  box.appendChild(footer);
  modal.appendChild(box);
  document.body.appendChild(modal);

  // Bind item clicks
  content.querySelectorAll('.suggestion-item').forEach(div => {
    div.addEventListener('click', () => {
      foodInput.value = div.textContent;
      suggestionsBox.style.display = 'none';
      document.body.removeChild(modal);
      searchFood();
    });
  });

  // Close button
  document.getElementById('closeModalBtn').addEventListener('click', () => {
    document.body.removeChild(modal);
  });
}


    // suggestions click
    suggestionsBox.addEventListener('click', e => {
      if(e.target.classList.contains('show-more')) {
        showFullResults(foodInput.value.trim());
      } else if(e.target.tagName === 'DIV'){
        foodInput.value = e.target.textContent;
        suggestionsBox.style.display = 'none';
        searchFood();
      }
    });

    // debounce
    let debounceTimer;
    foodInput.addEventListener('input', e => {
      const q = e.target.value.trim();
      clearTimeout(debounceTimer);
      if(!q){ suggestionsBox.style.display = 'none'; return; }
      debounceTimer = setTimeout(()=> renderSuggestions(q), 200);
    });

    // search logic
    searchBtn.addEventListener('click', searchFood);
    function searchFood(){
      const term = (foodInput.value || '').trim().toLowerCase();
      if(!term){ resultContainer.innerHTML = ''; return; }
      // exact or fuzzy match
      const match = foodData.find(item => (item.name||'').toLowerCase() === term)
        || foodData.find(item => ((item.name||'').toLowerCase().includes(term)));
      if(!match){
        resultContainer.innerHTML = `<p style="color:#b91c1c">‚ùå No results for <strong>${term}</strong>.</p>`;
        currentFood = null;
        if(chart) chart.destroy();
        return;
      }
      currentFood = match;
      displayResult(match);
    }

    function displayResult(food){
      const serving = parseFloat(servingInput.value) || 100;
      const factor = serving / 100;
      const scaled = {
        kcal: (food.kcal || 0) * factor,
        protein: (food.protein || 0) * factor,
        carbs: (food.carbs || 0) * factor,
        fat: (food.fat || 0) * factor,
        sugar: (food.sugar || 0) * factor
      };
      resultContainer.innerHTML = `
      <div class="result-card">
        <h3 style="margin-top:0">${food.name}</h3>
        <p><strong>Serving Size:</strong> ${serving} g</p>
        <p><strong>Calories:</strong> ${scaled.kcal.toFixed(1)} kcal</p>
        <p><strong>Protein:</strong> ${scaled.protein.toFixed(1)} g</p>
        <p><strong>Carbs:</strong> ${scaled.carbs.toFixed(1)} g</p>
        <p><strong>Fat:</strong> ${scaled.fat.toFixed(1)} g</p>
        <p><strong>Sugar:</strong> ${scaled.sugar.toFixed(1)} g</p>
        <div class="chart-container"><canvas id="nutrientChart"></canvas></div>
        <div style="margin-top:10px">
          <button id="addToTotalBtn" style="margin-right:8px;background:#16a34a">Add to Daily Summary</button>
          <button id="clearBtn" style="background:#dc2626">Clear</button>
        </div>
      </div>`;
      drawChart(scaled);

      document.getElementById('addToTotalBtn').addEventListener('click', ()=> addToDailyTotal(scaled));
      document.getElementById('clearBtn').addEventListener('click', ()=> {
        foodInput.value = '';
        servingInput.value = 100;
        resultContainer.innerHTML = '';
        if(chart) chart.destroy();
      });
    }

    function drawChart(data){
      const ctx = document.getElementById('nutrientChart').getContext('2d');
      if(chart) chart.destroy();
      const dark = document.body.classList.contains('dark');
      const textColor = dark ? '#e6eef8' : '#111';
      const barColor = dark ? '#60a5fa' : '#2563eb';
      chart = new Chart(ctx, {
        type: 'bar',
        data: { labels:['Calories','Protein','Carbs','Fat','Sugar'], datasets:[{ data:[data.kcal,data.protein,data.carbs,data.fat,data.sugar], backgroundColor: barColor, borderRadius:6 }]},
        options: {
          responsive:true, maintainAspectRatio:false,
          plugins:{legend:{display:false}},
          scales:{ x:{ ticks:{ color:textColor } }, y:{ beginAtZero:true, ticks:{ color:textColor } } }
        }
      });
    }

    // expose updateChartColors so theme toggle can call it
    window.updateChartColors = function(){
      if(!chart) return;
      const dark = document.body.classList.contains('dark');
      const barColor = dark ? '#60a5fa' : '#2563eb';
      const textColor = dark ? '#e6eef8' : '#111';
      chart.data.datasets[0].backgroundColor = barColor;
      chart.options.scales.x.ticks.color = textColor;
      chart.options.scales.y.ticks.color = textColor;
      chart.update();
    };

    function addToDailyTotal(data){
      for(const k in data) if(Object.prototype.hasOwnProperty.call(data,k)) dailyTotals[k] += (data[k] || 0);
      updateDailySummary();
    }
    function updateDailySummary(){
      dailySummary.style.display = 'block';
      dailyTotalsDiv.innerHTML = `
        <p><strong>Calories:</strong> ${dailyTotals.kcal.toFixed(1)} kcal</p>
        <p><strong>Protein:</strong> ${dailyTotals.protein.toFixed(1)} g</p>
        <p><strong>Carbs:</strong> ${dailyTotals.carbs.toFixed(1)} g</p>
        <p><strong>Fat:</strong> ${dailyTotals.fat.toFixed(1)} g</p>
        <p><strong>Sugar:</strong> ${dailyTotals.sugar.toFixed(1)} g</p>`;
    }

    clearAllBtn.addEventListener('click', ()=>{
      dailyTotals = { kcal:0, protein:0, carbs:0, fat:0, sugar:0 };
      dailySummary.style.display = 'none';
    });
  });
  </script>
</body>
</html>






