<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calorie & Nutrition Guide ‚Äî Convert Labs</title>
  <meta name="description" content="Use our guide and built-in calculator to estimate your BMR, TDEE and BMI ‚Äî then learn practical, safe advice for losing, gaining, or maintaining weight." />

  <!-- Social / OG -->
  <meta property="og:title" content="Calorie & Nutrition Guide ‚Äî Convert Labs" />
  <meta property="og:description" content="Calculate BMR, TDEE and BMI and get clear, actionable nutrition advice." />
  <meta property="og:image" content="https://convertlabs.online/assets/convertlabs-banner.jpg" />
  <meta property="og:url" content="https://convertlabs.online/tools/calorie-guide.html" />
  <meta property="og:type" content="article" />

  <!-- canonical -->
  <link rel="canonical" href="https://convertlabs.online/tools/calorie-guide.html" />
  <link rel="icon" href="https://convertlabs.online/assets/convert-labs-icon.png" />
  <meta name="theme-color" content="#1e40af" />
  
  <!-- Global CSS (site-wide) -->
  <link rel="stylesheet" href="https://convertlabs.online/style.css" />

  <!-- AdSense & Analytics (kept as requested) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2490597435056272" crossorigin="anonymous"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z88B03WV7P"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-Z88B03WV7P');
  </script>

  <!-- Page-specific styles: calculator, animations, and dark mode -->
  <style>
    :root {
      --page-max: 980px;
      --card-radius: 12px;
      --brand-blue: #1e40af;
      --muted: #58616a;
      --card-shadow: 0 10px 30px rgba(18, 26, 40, 0.08);
      --footer-dark: #0e2440;
      --brand: #0a4d8c;
      --brand-2: #134b8b;
      --bg: #f5faff;
      --card: #fff;
      --accent: #2b8bd8;
      --radius: 12px;
      --text: #111;
      --blue-600: #2563eb;
      --blue-700: #1e40af;
      --nav-blue: #1e3a8a;
      --card-bg: #fff;
      --dark-bg: #0b1220;
      --card-dark: #1b2435;
      --inner-card: #0f172a;
      --cta-from: #10b981;
      --cta-to: #3b82f6;
    }

    html.dark {
      --bg: #071029;
      --card: #081226;
      --text: #dbeafe;
      --muted: #9aa9b8;
      --accent: #34d399;
      --blue-600: #3b82f6;
      --blue-700: #60a5fa;
      --nav-blue: #1e293b;
      --card-bg: #0f172a;
      --dark-bg: #020617;
      --card-dark: #1e293b;
      --inner-card: #0f172a;
    }

    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }

    /* === UNIFIED HEADER STYLES === */
    header {
      height: auto;
      min-height: 64px;
      background: var(--brand-2);
      color: #fff;
      display: flex;
      align-items: center;
      padding: 12px 20px;
      position: sticky;
      top: 0;
      z-index: 100;
      flex-wrap: wrap;
      gap: 12px;
      width: 100%;
    }

    .brand {
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-shrink: 0;
    }

    .nav-links {
      display: flex;
      gap: 12px;
      margin: 0 auto;
      flex-wrap: wrap;
      justify-content: center;
    }

    .nav-links a {
      color: #fff;
      text-decoration: none;
      font-weight: 500;
      padding: 6px 10px;
      border-radius: 6px;
      transition: background-color 0.2s;
      font-size: 14px;
    }

    .nav-links a:hover {
      background: rgba(255,255,255,0.1);
    }

    .btn {
      background: var(--brand);
      color: #fff;
      padding: 8px 12px;
      border-radius: 10px;
      border: 0;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
      flex-shrink: 0;
    }

    .btn:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .btn.ghost {
      background: transparent;
      border: 1px solid var(--brand);
      color: var(--brand);
    }

    .theme-toggle-container {
      margin-left: auto;
      flex-shrink: 0;
    }

    /* Main area */
    main{
      max-width: var(--page-max);
      margin: 1.5rem auto;
      color: var(--text);
      padding: 0 16px;
    }

    .hero-card{
      border-radius: 14px;
      padding: 36px;
      background: var(--card);
      box-shadow: var(--card-shadow);
    }
    .page-title{font-size:32px;margin:0 0 12px;color:var(--brand-2);font-weight:800}
    .lead{color:var(--muted);line-height:1.6;margin:0 0 20px}

    /* Calculator card */
    .calc-card{
      margin-top:24px;
      border-radius:12px;
      padding:22px;
      background: var(--card);
      box-shadow: var(--card-shadow);
      border:1px solid rgba(30,58,138,0.04);
    }
    .calc-card h3{margin:0 0 16px;color:var(--blue-700)}
    .field{margin:10px 0;display:block}
    label.field-label{display:block;color:var(--muted);font-size:14px;margin-bottom:6px}
    input[type="number"], select, input[type="text"]{
      width:270px;max-width:100%;
      padding:10px 12px;border-radius:8px;border:1px solid #e6eef8;background:var(--card);color:var(--text);
      box-sizing:border-box;
    }
    select{appearance:auto}
    .small{width:160px}

    .actions{margin-top:14px}
    .calc-btn{
      display:inline-block;padding:10px 14px;border-radius:8px;border:none;cursor:pointer;font-weight:600;
      background:var(--blue-600);color:#fff;
      box-shadow: 0 6px 16px rgba(37,99,235,0.12);
    }
    .muted{color:var(--muted);margin-top:10px;font-size:14px}

    /* Result box */
    .result-box{
      margin-top:18px;padding:14px;border-radius:10px;background:var(--card);border:1px solid rgba(16,24,40,0.04);
      box-shadow: 0 8px 20px rgba(16,24,40,0.04);
    }
    .result-row{display:flex;gap:12px;align-items:center;margin:8px 0}
    .result-label{min-width:160px;color:var(--muted);font-weight:600}

    /* Advice */
    .advice{margin-top:10px;padding:12px;border-radius:8px;background:var(--card);border:1px solid rgba(59,130,246,0.06)}

    /* Back button */
    .back-btn{display:inline-block;margin-top:18px;padding:12px 18px;background:var(--blue-600);color:#fff;border-radius:10px;text-decoration:none;font-weight:700}

    /* === UNIFIED FOOTER STYLES === */
    footer.footer { 
      background: var(--brand-2); 
      color:#fff; 
      text-align:center; 
      padding:2rem 1rem; 
      margin-top:2.5rem; 
      width: 100%;
    }

    footer.footer a { 
      color: #f8fafc; 
      text-decoration: none;
    }

    footer.footer a:hover { 
      text-decoration: underline; 
      color: #ffffff; 
    }

    /* Dark-mode overrides */
    html.dark .hero-card{ background: var(--card); }
    html.dark .page-title{ color:#93c5fd; }
    html.dark .lead{ color:#cbd5e1; }
    html.dark .calc-card{ background: var(--card); border:1px solid #263447; }
    html.dark input[type="number"], html.dark select, html.dark input[type="text"]{
      background:var(--card);border:1px solid #2c3b53;color:var(--text);
    }
    html.dark .calc-card h3{ color:#60a5fa; }
    html.dark .result-box{ background:var(--card); border:1px solid #263447; }
    html.dark .calc-btn{ box-shadow:0 6px 20px rgba(59,130,246,0.12); }
    html.dark .advice{ background:var(--card); border:1px solid rgba(99,102,241,0.06); }
    html.dark footer.footer { background: var(--brand-2); }

    /* tiny */
    .muted small {
      color: var(--muted);
    }

    /* Strong override for disclaimer in dark mode */
    .nutrition-disclaimer { 
      margin-top:30px;
      padding:18px;
      background:#f7f7f7;
      border-left:4px solid #4A90E2;
      border-radius:6px;
      font-size:15px;
      line-height:1.6;
      color:#222;
    }
    html.dark .nutrition-disclaimer { 
      background: #1c253a !important; 
      color: #e7e7e7 !important; 
      border-left: 4px solid #6aa0ff !important; 
    }
    html.dark .nutrition-disclaimer a { 
      color: #cfe3ff !important; 
    }

    /* ------------------ CTA animations (base) ------------------ */
    @keyframes fadeSlideUp {
      0% { opacity: 0; transform: translateY(14px) scale(0.97); }
      60% { opacity: 1; transform: translateY(-2px) scale(1.02); }
      100% { transform: translateY(0) scale(1); }
    }

    @keyframes softGlowPulse {
      0% { box-shadow: 0 0 0px rgba(255,255,255,0); }
      50% { box-shadow: 0 0 18px rgba(255,255,255,0.05); }
      100% { box-shadow: 0 0 0px rgba(255,255,255,0); }
    }

    .generate-plan-animate {
      animation: fadeSlideUp 0.45s ease-out forwards, softGlowPulse 1.4s ease-out 0.45s;
    }

    #goMealPlanBtn { 
      background: linear-gradient(90deg, var(--cta-from), var(--cta-to)); 
      border: none; color: #fff; padding: 10px 16px; border-radius: 10px; cursor: pointer;
      transition: transform .18s ease, box-shadow .18s ease, filter .18s;
    }
    #goMealPlanBtn:hover { transform: scale(1.05); filter: brightness(1.02); }

    .recommended-label { font-size:14px; color:var(--blue-700); margin-bottom:6px; opacity:0; animation: fadeSlideUp 0.4s ease-out forwards; }
    html.dark .recommended-label { color:#63b3ff; }

    /* ===== Enhanced Boosted Animations ===== */
    @keyframes pulseRingAnim {
      0% { transform: scale(0.4); opacity:0.25; box-shadow: 0 0 0 0 rgba(16,185,129,0.4); }
      70% { transform: scale(1.2); opacity:0.15; box-shadow: 0 0 32px 8px rgba(16,185,129,0.2); }
      100% { transform: scale(1.35); opacity:0; }
    }
    .pulse-ring { position:absolute; top:50%; left:50%; width:130px; height:130px; margin-top:-65px; margin-left:-65px; border-radius:50%; pointer-events:none; opacity:0; animation: pulseRingAnim 1.7s ease-out forwards; z-index:5; }

    @keyframes breathe { 0%{transform:scale(1);} 50%{transform:scale(1.035);} 100%{transform:scale(1);} }
    .breathe { animation: breathe 2.6s ease-in-out infinite; }

    @keyframes floatArrow { 0%{opacity:0; transform:translateY(8px)} 30%{opacity:1; transform:translateY(0)} 100%{opacity:1; transform:translateY(-6px)} }
    .arrow-hint { opacity:0; animation: floatArrow 1.6s ease-out forwards 0.4s; font-size:22px; color:var(--blue-700); margin-bottom:6px; }
    html.dark .arrow-hint { color:#63b3ff; }

    /* Ripple effect */
    .ripple {
      position: absolute;
      border-radius: 50%;
      transform: scale(0);
      animation: rippleAnim 600ms linear;
      background: rgba(255,255,255,0.35);
      pointer-events: none;
      z-index: 20;
    }
    @keyframes rippleAnim {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }

    /* Sparkles */
    .sparkle {
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 2px;
      opacity: 0;
      transform: translateY(0) scale(0.6);
      animation: sparkleAnim 700ms ease-out forwards;
      pointer-events:none;
      z-index:15;
    }
    @keyframes sparkleAnim {
      0% { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-26px) scale(0.2); }
    }

    /* Confetti canvas sits on top */
    canvas#confettiCanvas { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:2000; display:none; }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      header {
        padding: 10px 16px;
        gap: 8px;
      }
      .nav-links {
        gap: 8px;
      }
      .nav-links a {
        padding: 5px 8px;
        font-size: 13px;
      }
      .brand span {
        font-size: 14px;
      }
      .hero-card {
        padding: 24px;
      }
      .page-title {
        font-size: 1.6rem;
      }
      input[type="number"], select, input[type="text"] {
        width: 100%;
      }
    }

    @media (max-width: 480px) {
      .nav-links {
        gap: 6px;
      }
      .nav-links a {
        padding: 4px 6px;
        font-size: 12px;
      }
      header {
        padding: 8px 12px;
      }
      .hero-card {
        padding: 18px;
      }
    }
  </style>
</head>
<body>
  <!-- === UNIFIED HEADER === -->
  <header role="banner">
    <div class="brand">
      <img src="https://convertlabs.online/assets/convert-labs-icon.png" alt="Convert Labs" style="width:32px;height:32px;">
      <span>Convert Labs</span>
    </div>
    <nav class="nav-links" aria-label="Main navigation">
      <a href="https://convertlabs.online/index.html">Home</a>
      <a href="https://convertlabs.online/tools/tools.html">Tools</a>
      <a href="https://convertlabs.online/guides.html">Blog</a>
      <a href="https://convertlabs.online/about.html">About</a>
      <a href="https://convertlabs.online/contact.html">Contact</a>
    </nav>
    <div class="theme-toggle-container">
      <button id="themeToggle" class="btn ghost" style="min-width:44px;">üåô</button>
    </div>
  </header>

  <main role="main">
    <div class="hero-card">
      <h1 class="page-title">Calorie & Nutrition Guide</h1>
      <p class="lead">Use this guide and the calculator below to determine your <strong>BMR</strong> (Basal Metabolic Rate), <strong>TDEE</strong> (Total Daily Energy Expenditure), and <strong>BMI</strong> (Body Mass Index). Then get clear, practical advice to lose, gain, or maintain weight.</p>

      <!-- Calculator card -->
      <div class="calc-card">
        <h3>üìä Calculate Your BMR, TDEE & BMI</h3>

        <div class="field">
          <label class="field-label">Gender</label>
          <select id="gender">
            <option value="male">Male</option>
            <option value="female">Female</option>
          </select>
        </div>

        <div class="field">
          <label class="field-label">Age</label>
          <input id="age" type="number" placeholder="Years" min="10" />
        </div>

        <div class="field">
          <label class="field-label">Weight (kg)</label>
          <input id="weight" type="number" placeholder="kg" min="20" step="0.1" />
        </div>

        <div class="field">
          <label class="field-label">Height (cm)</label>
          <input id="height" type="number" placeholder="cm" min="80" />
        </div>

        <div class="field">
          <label class="field-label">Activity Level</label>
          <select id="activity">
            <option value="1.2">Sedentary (little or no exercise)</option>
            <option value="1.375">Light activity (1‚Äì3 days/week)</option>
            <option value="1.55">Moderate activity (3‚Äì5 days/week)</option>
            <option value="1.725">Active (6‚Äì7 days/week)</option>
            <option value="1.9">Very active (hard physical work or training)</option>
          </select>
        </div>

        <div class="field">
          <label class="field-label">Goal</label>
          <select id="goal">
            <option value="maintain">Maintain weight</option>
            <option value="lose">Lose weight</option>
            <option value="gain">Gain weight</option>
          </select>
        </div>

        <!-- NEW: Diet & Protein selects (required for meal-plan redirect) -->
        <div class="field">
          <label class="field-label">Diet Style</label>
          <select id="dietSelect">
            <option value="normal">No preference</option>
            <option value="keto">Keto</option>
            <option value="carnivore">Carnivore</option>
            <option value="vegetarian">Vegetarian</option>
          </select>
        </div>

        <div class="field">
          <label class="field-label">Protein Preference</label>
          <select id="proteinSelect">
            <option value="any">Any</option>
            <option value="beef">Beef</option>
            <option value="chicken">Chicken</option>
            <option value="fish">Fish</option>
            <option value="plant">Plant-based</option>
          </select>
        </div>

        <div class="actions">
          <button id="calcBtn" class="calc-btn">Calculate</button>
        </div>

        <div id="results" class="result-box" style="display:none;">
          <div class="result-row"><div class="result-label">BMR</div><div id="resBmr">‚Äî kcal/day</div></div>
          <div class="result-row"><div class="result-label">TDEE (est.)</div><div id="resTdee">‚Äî kcal/day</div></div>
          <div class="result-row"><div class="result-label">BMI</div><div id="resBmi">‚Äî</div></div>
          <div class="result-row"><div class="result-label">Daily target</div><div id="resTarget">‚Äî kcal/day</div></div>

          <div id="adviceBox" class="advice" style="display:none;margin-top:12px"></div>

          <!-- Enhanced CTA area (label + arrow + pulse + button) -->
          <div style="margin-top:22px; text-align:center; position:relative;">
            <div id="recommendedLabel" class="recommended-label" style="display:none;">‚≠ê Recommended Based on Your Results</div>
            <div id="arrowHint" class="arrow-hint" style="display:none;">‚¨áÔ∏è</div>
            <div id="pulseRing" class="pulse-ring" style="display:none;"></div>

            <button id="goMealPlanBtn" class="calc-btn" style="display:none;position:relative;z-index:10;background:linear-gradient(90deg,var(--cta-from),var(--cta-to));">
              Generate My Meal Plan ‚Üí
            </button>
          </div>

        </div>

        <p class="muted" style="margin-top:12px">
          <small>Note: These are estimates for general guidance only. For medical or clinical recommendations consult a registered dietitian or physician.</small>
        </p>
      </div>

      <div class="nutrition-disclaimer">
        <strong>Nutrition Data Notice:</strong><br>
        All nutrition values provided on this website come exclusively from the 
        <strong>USDA FoodData Central</strong> public-domain database.<br>
        Traditional or regional dishes have been temporarily removed to comply with 
        <strong>Google Publisher Policies</strong> relating to health and nutrition data accuracy.<br><br>
        This tool is intended for general informational purposes only and should not be considered 
        medical, nutritional, or dietary advice. For personalized guidance, please consult a certified 
        nutritionist or healthcare professional.
      </div>

      <a class="back-btn" href="https://convertlabs.online/tools/calorie-calculator.html">‚Üê Back to Calorie Calculator</a>
    </div>
  </main>

  <!-- Confetti Canvas (hidden until triggered) -->
  <canvas id="confettiCanvas"></canvas>

  <!-- === UNIFIED FOOTER === -->
  <footer class="footer">
    <div class="container" style="max-width:1100px;margin:0 auto;text-align:center;padding:20px;">
      <div class="footer-brand" style="margin-bottom:10px;">
        <img src="https://convertlabs.online/assets/convert-labs-icon.png" alt="Convert Labs" style="width:24px;height:24px;vertical-align:middle;">
        <span style="margin-left:6px;font-weight:600;">Convert Labs</span>
      </div>

      <p style="color:#ffffff;margin-bottom:10px;">¬© 2025 Convert Labs. All rights reserved.</p>

      <div style="width:100%;max-width:700px;height:1px;background:rgba(255,255,255,0.2);margin:0 auto 10px auto;"></div>

      <nav class="footer-links" style="margin-top:8px;">
        <a href="https://convertlabs.online/about.html" style="color:#f8fafc;text-decoration:none;margin:0 6px;">About</a> |
        <a href="https://convertlabs.online/tools/tools.html" style="color:#f8fafc;text-decoration:none;margin:0 6px;">Tools</a> |
        <a href="https://convertlabs.online/guides.html" style="color:#f8fafc;text-decoration:none;margin:0 6px;">Blog</a> |
        <a href="https://convertlabs.online/privacy.html" style="color:#f8fafc;text-decoration:none;margin:0 6px;">Privacy</a> |
        <a href="https://convertlabs.online/disclaimer.html" style="color:#f8fafc;text-decoration:none;margin:0 6px;">Disclaimer</a> |
        <a href="https://convertlabs.online/terms.html" style="color:#f8fafc;text-decoration:none;margin:0 6px;">Terms</a> |
        <a href="https://convertlabs.online/contact.html" style="color:#f8fafc;text-decoration:none;margin:0 6px;">Contact</a>
      </nav>
    </div>
    <section class="site-verification" style="font-size:14px; color:#f1f1f1; text-align:center; margin-top:25px; line-height:1.6;">
      <p>‚úÖ <strong>Domain Verification & Email Security</strong></p>
      <p>
        Convert Labs is officially verified for secure DNS and authenticated email delivery.  
        Our domain (<a href="https://convertlabs.online" target="_blank" style="color:#9dc6ff;">convertlabs.online</a>)  
        uses trusted <strong>Cloudflare</strong> infrastructure with validated DNS records.
      </p>
      <p>
        Email protection includes:
        <ul style="list-style:none; padding:0; margin:5px 0;">
          <li>‚úî <strong>SPF</strong> ‚Äì Approved senders: Cloudflare & Outlook Mail servers</li>
          <li>‚úî <strong>DKIM</strong> ‚Äì 2048-bit RSA signature verified (<em>selector: cf2024-1</em>)</li>
          <li>‚úî <strong>DMARC</strong> ‚Äì Active monitoring for spoofing and spam prevention</li>
        </ul>
      </p>
      <p>
        These records confirm the legitimacy of our domain and improve deliverability,  
        search engine trust, and AdSense approval readiness.
      </p>
    </section>
  </footer>

  <!-- Calculator logic + theme persistence + CTA wiring + confetti + audio -->
  <script>
    // ----------------------------
    // Theme toggle + persistence (updated to match unified structure)
    // ----------------------------
    function initTheme() {
      const savedTheme = localStorage.getItem('convertlabs-theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
        document.documentElement.classList.add('dark');
        document.getElementById('themeToggle').textContent = '‚òÄÔ∏è';
      } else {
        document.documentElement.classList.remove('dark');
        document.getElementById('themeToggle').textContent = 'üåô';
      }
    }

    function toggleTheme() {
      const isDark = document.documentElement.classList.toggle('dark');
      document.getElementById('themeToggle').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
      localStorage.setItem('convertlabs-theme', isDark ? 'dark' : 'light');
    }

    // Initialize theme and event listener
    document.addEventListener('DOMContentLoaded', function() {
      initTheme();
      document.getElementById('themeToggle').addEventListener('click', toggleTheme);
    });

    // ----------------------------
    // Utility: simple toast (small)
    // ----------------------------
    function toast(msg){
      const t = document.createElement('div');
      t.textContent = msg;
      t.style.cssText = 'position:fixed;right:18px;bottom:18px;background:#0a4d8c;color:#fff;padding:10px 14px;border-radius:8px;z-index:9999';
      document.body.appendChild(t);
      setTimeout(()=> t.style.opacity = 0, 1600);
      setTimeout(()=> t.remove(), 2200);
    }

    // ----------------------------
    // Calculator logic
    // ----------------------------
    const calcBtn = document.getElementById('calcBtn');
    const showResults = (bmr,tdee,bmi,target,adviceHtml) => {
      document.getElementById('resBmr').textContent = Math.round(bmr) + ' kcal/day';
      document.getElementById('resTdee').textContent = Math.round(tdee) + ' kcal/day';
     localStorage.setItem('userTDEE', Math.round(target));
      document.getElementById('resBmi').textContent = bmi.toFixed(1);
      document.getElementById('resTarget').textContent = Math.round(target) + ' kcal/day';
      document.getElementById('adviceBox').innerHTML = adviceHtml;
      document.getElementById('adviceBox').style.display = 'block';
      document.getElementById('results').style.display = 'block';
      window.scrollTo({ top: document.getElementById('results').offsetTop - 120, behavior:'smooth' });
    };

    function interpretBMI(bmi){
      if(bmi < 18.5) return {label:'Underweight', msg:'Your BMI indicates underweight. Consider gradual healthy weight gain through calorie surplus and strength training.'};
      if(bmi < 25) return {label:'Normal', msg:'Your BMI is within the normal range ‚Äî maintain balanced diet and consistent activity.'};
      if(bmi < 30) return {label:'Overweight', msg:'Your BMI indicates overweight. A modest calorie deficit (~300‚Äì500 kcal/day) with increased activity is often effective.'};
      return {label:'Obese', msg:'BMI in the obese range. Consider speaking to a healthcare professional for a tailored plan.'};
    }

    // WebAudio click sound (plays only on user gesture)
    let audioCtx = null;
    function playClickSound(){
      try {
        if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = 'sine';
        o.frequency.setValueAtTime(880, audioCtx.currentTime);
        g.gain.setValueAtTime(0, audioCtx.currentTime);
        g.gain.linearRampToValueAtTime(0.08, audioCtx.currentTime + 0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.38);
        o.connect(g); g.connect(audioCtx.destination);
        o.start();
        o.stop(audioCtx.currentTime + 0.45);
      } catch(e){}
    }

    // Confetti implementation (lightweight)
    function launchConfetti(){
      const canvas = document.getElementById("confettiCanvas");
      canvas.style.display = "block";
      const ctx = canvas.getContext("2d");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const confettiCount = 120;
      const confetti = [];
      const colors = ["#3b82f6","#10b981","#60a5fa","#a5b4fc","#facc15"];

      for(let i=0;i<confettiCount;i++){
        confetti.push({
          x: Math.random()*canvas.width,
          y: canvas.height + Math.random()*100,
          r: Math.random()*6 + 4,
          color: colors[Math.floor(Math.random()*colors.length)],
          speed: Math.random()*3 + 2,
          tilt: Math.random()*10 - 5,
          rot: Math.random()*360
        });
      }

      function draw(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        confetti.forEach((c,i)=>{
          ctx.save();
          ctx.translate(c.x,c.y);
          ctx.rotate(c.rot * Math.PI/180);
          ctx.fillStyle = c.color;
          ctx.fillRect(-c.r/2, -c.r/2, c.r, c.r*0.6);
          ctx.restore();

          c.y -= c.speed;
          c.x += Math.sin(c.y*0.02)*2;
          c.rot += 4;
          if(c.y < -30) confetti[i].y = canvas.height + 30;
        });
      }

      let anim;
      function loop(){ draw(); anim = requestAnimationFrame(loop); }
      loop();

      setTimeout(()=>{ cancelAnimationFrame(anim); canvas.style.display = "none"; }, 2200);
    }

    // Ripple creation on button click
    function createRipple(el, clientX, clientY){
      const rect = el.getBoundingClientRect();
      const ripple = document.createElement('span');
      ripple.className = 'ripple';
      const size = Math.max(rect.width, rect.height);
      ripple.style.width = ripple.style.height = size + 'px';
      ripple.style.left = (clientX - rect.left - size/2) + 'px';
      ripple.style.top = (clientY - rect.top - size/2) + 'px';
      el.appendChild(ripple);
      setTimeout(()=> ripple.remove(), 700);
    }

    // Sparkles inside button
    function spawnSparkles(el, count=8){
      for(let i=0;i<count;i++){
        const s = document.createElement('div');
        s.className = 'sparkle';
        s.style.background = ['#fff','#fff','#ffdce6','#ffffff'][Math.floor(Math.random()*4)];
        s.style.left = (10 + Math.random()*(el.offsetWidth-20)) + 'px';
        s.style.top = (Math.random()* (el.offsetHeight-6)) + 'px';
        el.appendChild(s);
        setTimeout(()=> s.remove(), 900);
      }
    }

    // Haptic feedback
    function haptic(){
      try { if(navigator.vibrate) navigator.vibrate(18); } catch(e){}
    }

    // Redirect function
    function goToMealPlan(finalTDEE){
      const age = document.getElementById("age")?.value || "";
      const goal = document.getElementById("goal")?.value || "maintain";
      const diet = document.getElementById("dietSelect")?.value || "normal";
      const protein = document.getElementById("proteinSelect")?.value || "any";

      const url =
        "/tools/meal-plan.html"
        + "?tdee=" + encodeURIComponent(Math.round(finalTDEE))
        + "&age=" + encodeURIComponent(age)
        + "&goal=" + encodeURIComponent(goal)
        + "&diet=" + encodeURIComponent(diet)
        + "&protein=" + encodeURIComponent(protein);

      window.location.href = url;
    }

    // Read inputs helper
    function readInputs(){
      return {
        gender: document.getElementById('gender').value,
        age: Number(document.getElementById('age').value),
        weight: Number(document.getElementById('weight').value),
        height: Number(document.getElementById('height').value),
        activity: parseFloat(document.getElementById('activity').value),
        goal: document.getElementById('goal').value
      };
    }

    // Calculation & button reveal logic
    calcBtn.addEventListener('click', ()=>{
      const {gender,age,weight,height,activity,goal} = readInputs();

      // validations
      if(!age || !weight || !height || age < 10){
        alert('Please enter valid Age, Weight and Height.');
        return;
      }

      // Mifflin-St Jeor BMR
      let bmr;
      if(gender === 'male'){ bmr = 10*weight + 6.25*height - 5*age + 5; }
      else { bmr = 10*weight + 6.25*height - 5*age - 161; }

      // TDEE
      const tdee = bmr * activity;

      // BMI
      const bmi = weight / Math.pow(height/100, 2);

      // Decide target calories according to goal
      let target = tdee;
      let advice = '';
      if(goal === 'maintain'){
        target = tdee;
        advice = '<strong>Maintain</strong>: Eat roughly your TDEE each day. Focus on balanced macros and consistent activity.';
      } else if(goal === 'lose'){
        const deficit = 0.20;
        target = tdee * (1 - deficit);
        advice = `<strong>Lose weight</strong>: Aim for a gradual calorie deficit. Example: reduce ~${Math.round(tdee*deficit)} kcal/day (~20% deficit) to lose ~0.4‚Äì0.6 kg/week. Combine with protein-rich meals and resistance training.`;
      } else if(goal === 'gain'){
        const surplus = 0.15;
        target = tdee * (1 + surplus);
        advice = `<strong>Gain weight</strong>: Moderate surplus of ~${Math.round(tdee*surplus)} kcal/day (~15%) supports slow, lean muscle gain with strength training. Prefer nutrient-dense foods.`;
      }

      const bmiInterpret = interpretBMI(bmi);
      const fullAdvice = `
        <div><strong>BMI:</strong> ${bmiInterpret.label} ‚Äî ${bmiInterpret.msg}</div>
        <div style="margin-top:8px">${advice}</div>
        <div style="margin-top:8px">Use the <strong>Daily target</strong> as an average ‚Äî track progress weekly.</div>
      `;

      // show results
      showResults(bmr, tdee, bmi, target, fullAdvice);

      // reveal CTA with enhanced animation & effects
      const label = document.getElementById('recommendedLabel');
      const arrow = document.getElementById('arrowHint');
      const ring = document.getElementById('pulseRing');
      const btn = document.getElementById('goMealPlanBtn');

      // show label + arrow + pulse + button
      label.style.display = 'block';
      // small reflow to restart animation
      label.classList.remove('generate-plan-animate');
      void label.offsetWidth;
      label.classList.add('generate-plan-animate');

      arrow.style.display = 'block';
      ring.style.display = 'block';

      btn.style.display = 'inline-block';
      btn.classList.remove('generate-plan-animate');
      void btn.offsetWidth;
      btn.classList.add('generate-plan-animate');

      // pulse ring appears once (class already animates via CSS)
      // add breathing idle after a delay
      setTimeout(()=> { btn.classList.add('breathe'); }, 6000);

      // Ensure button actions: ripple, sparkle, haptic, sound, confetti, redirect
      btn.onclick = (ev) => {
        // ripple
        createRipple(btn, ev.clientX, ev.clientY);
        // sparkles
        spawnSparkles(btn, 8);
        // haptic
        haptic();
        // play click sound
        playClickSound();
        // confetti
        launchConfetti();
        // delay redirect slightly so user sees confetti & ripple
        setTimeout(()=> { goToMealPlan(target); }, 650);
      };

      // Accessibility: Enter key support when focused - optional
      btn.addEventListener('keyup', (e) => { if(e.key === 'Enter') btn.click(); });

      // Small toast
      toast('Ready ‚Äî Generate your personalized 7-day meal plan.');
    });

    // Manual animation reset when recalculated: hide previous CTA first
    document.getElementById('age').addEventListener('input', ()=> resetCTA());
    document.getElementById('weight').addEventListener('input', ()=> resetCTA());
    document.getElementById('height').addEventListener('input', ()=> resetCTA());
    function resetCTA(){
      const label = document.getElementById('recommendedLabel');
      const arrow = document.getElementById('arrowHint');
      const ring = document.getElementById('pulseRing');
      const btn = document.getElementById('goMealPlanBtn');
      label.style.display = 'none';
      arrow.style.display = 'none';
      ring.style.display = 'none';
      btn.style.display = 'none';
      btn.classList.remove('breathe');
    }

    // Ensure confetti canvas resizes with window
    window.addEventListener('resize', ()=> {
      const c = document.getElementById("confettiCanvas");
      if(c) { c.width = window.innerWidth; c.height = window.innerHeight; }
    });
  </script>
</body>
</html>
